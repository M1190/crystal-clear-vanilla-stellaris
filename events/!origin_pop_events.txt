################################
#
# Origin Events
# Written by Henrik Thyrwall
#
###############################

namespace = origin

# Scion Setup
country_event = {
	id = origin.5
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		set_country_flag = first_contact_event
		set_country_flag = Story2 # Already encountered spacefarers
		# Spawn mini-FE if player turned off Fallen Empires but picked this Origin anyway...
		if = {
			limit = {
				NOT = {
					any_country = {
						OR = {
							is_country_type = fallen_empire
							is_country_type = awakened_fallen_empire
						}
					}
				}
			}
			set_country_flag = scion_needs_fe
			if = {
				limit = { is_spiritualist = yes }
				random_system = {
					limit = { has_owner = no }
					spawn_system = { initializer = "scion_fallen_2" }
				}
			}
			else_if = {
				limit = {
					OR = {
						is_materialist = yes
						is_gestalt = yes
					}
				}
				random_system = {
					limit = { has_owner = no }
					spawn_system = { initializer = "scion_fallen_1" }
				}
			}
			else_if = {
				random_list = {
					10 = {
						random_system = {
							limit = { has_owner = no }
							spawn_system = { initializer = "scion_fallen_1" }
						}
					}
					10 = {
						random_system = {
							limit = { has_owner = no }
							spawn_system = { initializer = "scion_fallen_2" }
						}
					}
				}
			}
			add_extra_hyperlane_to_spawned_system_effect = yes
		}

		else_if = {
			limit = {
				is_spiritualist = yes
				any_country = { has_country_flag = fallen_empire_2 }
			}
			random_country = {
				limit = { has_country_flag = fallen_empire_2 }
				set_country_flag = scion_master
				save_global_event_target_as = scion_master
				add_opinion_modifier = {
					who = root
					modifier = opinion_scion
				}
				country_event = { id = origin.20 days = 9000 random = 9000 }
				root = {
					establish_communications_no_message = event_target:scion_master
					set_subject_of = {
						who = event_target:scion_master
						preset = preset_scion_dominion
					}
					add_opinion_modifier = {
						who = event_target:scion_master
						modifier = opinion_scion
					}
					country_event = { id = origin.10 days = 3 }
				}
			}
		}
		else_if = {
			limit = {
				is_materialist = yes
				any_country = { has_country_flag = fallen_empire_1 }
			}
			random_country = {
				limit = { has_country_flag = fallen_empire_1 }
				set_country_flag = scion_master
				save_event_target_as = scion_master
				add_opinion_modifier = {
					who = root
					modifier = opinion_scion
				}
				country_event = { id = origin.20 days = 9000 random = 9000 }
				root = {
					establish_communications_no_message = event_target:scion_master
					set_subject_of = {
						who = event_target:scion_master
						preset = preset_scion_satellite
					}
					add_opinion_modifier = {
						who = event_target:scion_master
						modifier = opinion_scion
					}
					country_event = { id = origin.10 days = 3 }
				}
			}
		}
		else_if = {
			limit = {
				is_machine_empire = yes
				any_country = { has_country_flag = fallen_empire_machine }
			}
			random_country = {
				limit = { has_country_flag = fallen_empire_machine }
				set_country_flag = scion_master
				save_event_target_as = scion_master
				add_opinion_modifier = {
					who = root
					modifier = opinion_scion
				}
				country_event = { id = origin.20 days = 9000 random = 9000 }
				root = {
					establish_communications_no_message = event_target:scion_master
					set_subject_of = {
						who = event_target:scion_master
						preset = preset_scion_auxiliary
					}
					add_opinion_modifier = {
						who = event_target:scion_master
						modifier = opinion_scion
					}
					country_event = { id = origin.10 days = 3 }
				}
			}
		}
		else_if = {
			limit = {
				OR = {
					is_pacifist = yes
					is_xenophile = yes
					has_valid_civic = civic_hive_empath
					has_valid_civic = civic_harm_hive
					has_valid_civic = civic_hive_memorialist
					has_valid_civic = civic_machine_servitor
					has_valid_civic = civic_machine_emotions
					has_valid_civic = civic_harm_machine
					has_valid_civic = civic_machine_memorialist
					has_government = "gov_knowledge_driven_collective"
					has_government = "gov_machine_research"
				}
				NOR = {
					is_militarist = yes
					is_xenophobe = yes
					has_valid_civic = civic_slaver_guilds
					has_valid_civic = civic_indentured_assets
					has_valid_civic = civic_hive_strength_of_legions
					has_valid_civic = civic_hive_subspace_ephapse
					has_valid_civic = civic_infestation
					has_valid_civic = civic_living_hosts
					has_valid_civic = civic_machine_assimilator
					has_valid_civic = civic_machine_warbots
					has_valid_civic = civic_machine_deepspace_networking
				}
				any_country = { has_country_flag = fallen_empire_3 }
			}
			random_country = {
				limit = { has_country_flag = fallen_empire_3 }
				set_country_flag = scion_master
				save_event_target_as = scion_master
				add_opinion_modifier = {
					who = root
					modifier = opinion_scion
				}
				if = {
					limit = {
						ROOT = { is_gestalt = no }
					}
					random_owned_planet = {
						limit = {
							has_planet_flag = fe_the_preserve
							free_housing > 0			
						}
						create_pop = { 
							species = root
						}	
					}
					ROOT = { set_country_flag = fe_xenophile_asked_pop }
				}
				country_event = { id = origin.20 days = 9000 random = 9000 }
				root = {
					establish_communications_no_message = event_target:scion_master
					set_subject_of = {
						who = event_target:scion_master
						preset = preset_scion_satellite
					}
					add_opinion_modifier = {
						who = event_target:scion_master
						modifier = opinion_scion
					}
					country_event = { id = origin.10 days = 3 }
				}
			}
		}
		else_if = {
			limit = {
				is_machine_empire = yes
				NOT = { has_valid_civic = civic_machine_assimilator }
				any_country = { has_country_flag = fallen_empire_1 }
			}
			random_country = {
				limit = { has_country_flag = fallen_empire_1 }
				set_country_flag = scion_master
				save_event_target_as = scion_master
				add_opinion_modifier = {
					who = root
					modifier = opinion_scion
				}
				country_event = { id = origin.20 days = 9000 random = 9000 }
				root = {
					establish_communications_no_message = event_target:scion_master
					set_subject_of = {
						who = event_target:scion_master
						preset = preset_scion_satellite
					}
					add_opinion_modifier = {
						who = event_target:scion_master
						modifier = opinion_scion
					}
					country_event = { id = origin.10 days = 3 }
				}
			}
		}
		else = {
			random_country = {
				limit = {
					OR = {
						has_country_flag = fallen_empire_1
						has_country_flag = fallen_empire_2
					}
				}
				set_country_flag = scion_master
				save_event_target_as = scion_master
				add_opinion_modifier = {
					who = root
					modifier = opinion_scion
				}
				country_event = { id = origin.20 days = 9000 random = 9000 }
				root = {
					establish_communications_no_message = event_target:scion_master
					if = {
						limit = { event_target:scion_master = { has_country_flag = fallen_empire_1 } }
						set_subject_of = {
							who = event_target:scion_master
							preset = preset_scion_satellite
						}
					}
					else_if = {
						limit = { event_target:scion_master = { has_country_flag = fallen_empire_2 } }
						set_subject_of = {
							who = event_target:scion_master
							preset = preset_scion_dominion
						}
					}
					else_if = {
						limit = { event_target:scion_master = { has_country_flag = fallen_empire_3 } }
						set_subject_of = {
							who = event_target:scion_master
							preset = preset_scion_signatory
						}
					}
					else_if = {
						limit = { event_target:scion_master = { has_country_flag = fallen_empire_machine } }
						set_subject_of = {
							who = event_target:scion_master
							preset = preset_scion_auxiliary
						}
					}
					add_opinion_modifier = {
						who = event_target:scion_master
						modifier = opinion_scion
					}
					country_event = { id = origin.10 days = 3 }
				}
			}
		}
		if = {
			limit = {
				exists = event_target:scion_master
			}
			create_scion_wormhole_link = yes
		}
		if = {
			limit = { event_target:scion_master = { has_country_flag = fallen_empire_1 } }
			add_random_research_option = {
				add_progress = 0.5
				area = physics
				tier = 1
				ignore_prereqs = no
				fail_effects = {
					add_monthly_resource_mult = {
						resource = physics_research
						value = @tier3researchreward
						min = @tier3researchmin
						max = @tier3researchmax
					}
				}
			}
			add_random_research_option = {
				add_progress = 0.5
				area = society
				tier = 1
				ignore_prereqs = no
				fail_effects = {
					add_monthly_resource_mult = {
						resource = society_research
						value = @tier3researchreward
						min = @tier3researchmin
						max = @tier3researchmax
					}
				}
			}
			add_random_research_option = {
				add_progress = 0.5
				area = engineering
				tier = 1
				ignore_prereqs = no
				fail_effects = {
					add_monthly_resource_mult = {
						resource = engineering_research
						value = @tier3researchreward
						min = @tier3researchmin
						max = @tier3researchmax
					}
				}
			}
		}
		else_if = {
			limit = { event_target:scion_master = { has_country_flag = fallen_empire_2 } }
			add_resource = { energy = 300 }
			add_resource = { minerals = 300 }
		}
	}
}

# Bring Into Fold War Goal Successful (HIDDEN)
# Necessary to bounce effects in this event from the war goal, or there is no truce period
country_event = {
	id = origin.6
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		event_target:scion_victim = {
			if = {
				limit = { event_target:scion_master = { has_country_flag = fallen_empire_1 } }
				set_subject_of = {
					who = event_target:scion_master
					preset = preset_scion_satellite
				}
			}
			else_if = {
				limit = { event_target:scion_master = { has_country_flag = fallen_empire_2 } }
				set_subject_of = {
					who = event_target:scion_master
					preset = preset_scion_dominion
				}
			}
			else_if = {
				limit = { event_target:scion_master = { has_country_flag = fallen_empire_3 } }
				set_subject_of = {
					who = event_target:scion_master
					preset = preset_scion_signatory
				}
			}
			else_if = {
				limit = { event_target:scion_master = { has_country_flag = fallen_empire_machine } }
				set_subject_of = {
					who = event_target:scion_master
					preset = preset_scion_auxiliary
				}
			}
		}
	}
}

# Intro Diplomatic Message
country_event = {
	id = origin.10
	title = TRANSMISSION

	desc = {
		trigger = {
			event_target:scion_master = {
				OR = {
					has_country_flag = fallen_empire_2
					has_country_flag = fallen_empire_3
				}
			}
		}
		text = "origin.10.a.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_1 }
		}
		text = "origin.10.b.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		text = "origin.10.c.desc"
	}

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = { save_event_target_as = scion_master }
	}

	option = {
		name = origin.10.a
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_2 }
			is_gestalt = no
		}
	}
	option = {
		name = origin.10.b
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_1 }
			is_gestalt = no
		}
	}
	option = {
		name = origin.10.c
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_3 }
			is_gestalt = no
		}
	}
	option = {
		name = origin.10.d
		trigger = {
			is_hive_empire = yes
		}
	}
	option = {
		name = origin.10.e
		trigger = {
			is_machine_empire = yes
		}
	}
}

# Reward (HIDDEN)
country_event = {
	id = origin.20
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		every_playable_country = {
			limit = {
				has_origin = origin_scion
				is_scion_subject = yes
				root = { is_overlord_to = prev }
			}
			random_list = {

				# Technologies
				50 = {
					modifier = {
						factor = 0
						scion_has_techs = yes
					}
					random_list = {
						33 = {
							modifier = {
								factor = 0
								AND = {
									has_technology = tech_alloys_1
									has_technology = tech_mineral_purification_2
									has_technology = tech_space_defense_station_improvement
									has_technology = tech_battleships
									has_technology = tech_titan_hull_1
								}
							}
							country_event = { id = origin.21 }
						}
						33 = {
							modifier = {
								factor = 0
								AND = {
									has_technology = tech_space_science_2
									has_technology = tech_self_aware_logic
									has_technology = tech_antimatter_power
									has_technology = tech_combat_computers_autonomous
									has_technology = tech_jump_drive_1
								}
							}
							country_event = { id = origin.22 }
						}
						33 = {
							modifier = {
								factor = 0
								AND = {
									has_technology = tech_eco_simulation
									has_technology = tech_society_2
									has_technology = tech_colonization_4
									has_technology = tech_climate_restoration
									has_technology = tech_ascension_theory
								}
							}
							country_event = { id = origin.23 }
						}
					}
				}

				# Resources
				50 = {
					country_event = { id = origin.24 }
				}
			}
		}
		# Repeat
		country_event = { id = origin.20 days = 9000 random = 9000 }
	}
}

# Reward - Engineering Tech
country_event = {
	id = origin.21
	title = TRANSMISSION
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_2 }
		}
		text = "origin.21.a.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_1 }
		}
		text = "origin.21.b.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_3 }
		}
		text = "origin.21.c.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		text = "origin.21.d.desc"
	}

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = { save_event_target_as = scion_master }
	}

	option = {
		name = origin.21.a
		scion_engineering_tech = yes
	}
}

# Reward - Physics Tech
country_event = {
	id = origin.22
	title = TRANSMISSION
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_2 }
		}
		text = "origin.21.a.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_1 }
		}
		text = "origin.21.b.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_3 }
		}
		text = "origin.21.c.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		text = "origin.21.d.desc"
	}

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = { save_event_target_as = scion_master }
	}

	option = {
		name = origin.21.a
		scion_physics_tech = yes
	}
}

# Reward - Society Tech
country_event = {
	id = origin.23
	title = TRANSMISSION
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_2 }
		}
		text = "origin.21.a.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_1 }
		}
		text = "origin.21.b.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_3 }
		}
		text = "origin.21.c.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		text = "origin.21.d.desc"
	}

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = { save_event_target_as = scion_master }
	}

	option = {
		name = origin.21.a
		scion_society_tech = yes
	}
}

# Reward - Resources
country_event = {
	id = origin.24
	title = TRANSMISSION
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_2 }
		}
		text = "origin.21.a.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_1 }
		}
		text = "origin.21.b.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_3 }
		}
		text = "origin.21.c.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		text = "origin.24.d.desc"
	}

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = { save_event_target_as = scion_master }
	}

	option = {
		name = origin.21.a
		locked_random_list = {
			33 = { add_resource = { alloys = 5000 } }
			33 = { add_resource = { alloys = 4000 } }
			33 = { add_resource = { alloys = 3000 } }
			33 = { add_resource = { consumer_goods = 5000 } }
			33 = { add_resource = { consumer_goods = 4000 } }
			33 = { add_resource = { consumer_goods = 3000 } }
		}
	}
}

# Scion Tasks
event = {
	id = origin.25
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		any_playable_country = {
			is_scion_subject = yes
		}
	}

	immediate = {
		random_playable_country = {
			limit = {
				is_scion_subject = yes
			}
			save_event_target_as = scion_subject
			overlord = { save_event_target_as = scion_master }
			random_list = {
				500 = {}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = scion_requested_leader
							any_owned_leader = {
								is_valid_scion_leader = yes
								has_skill >= 5
							}
							AND = {
								is_robot_empire = no
								event_target:scion_master = { has_country_flag = fallen_empire_machine }
							}
						}
					}
					country_event = { id = origin.26 }
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = scion_gave_leader
							AND = {
								is_robot_empire = no
								event_target:scion_master = { has_country_flag = fallen_empire_machine }
							}
						}
					}
					country_event = { id = origin.27 }
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = scion_gave_ships
					}
					modifier = {
						factor = 0
						NOT = { mid_game_years_passed > 1 }
						NOR = {
							any_neighbor_country = {
								relative_power = { who = event_target:scion_subject category = fleet value > equivalent }
								opinion_level = { who = event_target:scion_subject level <= poor }
								is_subject = no
								NOR = {
									has_non_aggression_pact = event_target:scion_subject
									has_association_status = event_target:scion_subject
									is_in_federation_with = event_target:scion_subject
								}
								OR = {
									is_rival = event_target:scion_subject
									relative_power = { who = event_target:scion_subject category = fleet value = overwhelming }
									is_homicidal = yes
									is_slaver = yes
								}
							}
							AND = {
								OR = {
									has_country_flag = scion_requested_leader
									has_country_flag = scion_gave_leader
								}
								years_passed > 75
							}
							AND = {
								has_country_flag = scion_requested_leader
								has_country_flag = scion_gave_leader
								years_passed > 50
							}
						}
					}
					country_event = { id = origin.28 }
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = scion_lost_probe
							event_target:scion_master = { has_country_flag = fallen_empire_machine }
						}
					}
					modifier = {
						factor = 0
						NOT = {
							any_planet_within_border = {
								OR = {
									is_planet_class = pc_barren
									is_planet_class = pc_barren_cold
									is_planet_class = pc_frozen
								}
								solar_system = {
									NOR = {
										has_star_flag = empire_cluster
										has_star_flag = hostile_system
									}
									distance = {
										source = ROOT.capital_scope
										use_bypasses = no
										min_jumps = 8
									}
								}
							}
						}
					}
					country_event = { id = civicsexpanded.85 }
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = scion_contingency_base
							event_target:scion_master = { NOT = { has_country_flag = fallen_empire_machine } }
							has_global_flag = galactic_crisis_happened
							has_global_flag = ai_invasion_happened
							has_crisis = yes
						}
					}
					modifier = {
						factor = 0
						NOT = {
							any_planet_within_border = {
								OR = {
									is_planet_class = pc_barren
									is_planet_class = pc_barren_cold
									is_planet_class = pc_frozen
								}
								solar_system = {
									NOR = {
										has_star_flag = empire_cluster
										has_star_flag = hostile_system
									}
									distance = {
										source = ROOT.capital_scope
										use_bypasses = no
										min_jumps = 8
									}
								}
							}
						}
					}
					country_event = { id = civicsexpanded.87 }
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = scion_bio_scans
							event_target:scion_master = {
								NOR = {
									has_country_flag = fallen_empire_1
									has_country_flag = fallen_empire_3
								}
							}
						}
					}
					modifier = {
						factor = 0
						NOT = {
							any_planet_within_border = {
								OR = {
									is_wet = yes
									is_dry = yes
									is_cold = yes
								}
								solar_system = {
									NOR = {
										has_star_flag = empire_cluster
										has_star_flag = hostile_system
									}
									distance = {
										source = ROOT.capital_scope
										use_bypasses = no
										min_jumps = 5
									}
								}
							}
						}
					}
					country_event = { id = civicsexpanded.89 }
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = scion_missionaries
							is_gestalt = yes
							event_target:scion_master = {
								NOT = { has_country_flag = fallen_empire_2 }
							}
							has_modifier = fe_missionaries
						}
					}
					country_event = { id = civicsexpanded.94 }
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = scion_debugging
							NOT = { has_technology = tech_self_aware_logic }
							event_target:scion_master = {
								NOT = { has_country_flag = fallen_empire_machine }
							}
							has_global_flag = galactic_crisis_happened
							has_global_flag = ai_invasion_happened
							has_crisis = yes
						}
					}
					country_event = { id = civicsexpanded.95 }
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = scion_hive_study
							is_hive_empire = no
							event_target:scion_master = {
								NOR = {
									has_country_flag = fallen_empire_1
									has_country_flag = fallen_empire_3
								}
							}
							NOT = {
								any_owned_planet = {
									count_owned_pop = { limit = { pop_has_trait = trait_hive_mind } count > 20 }
								}
							}
						}
					}
					country_event = { id = civicsexpanded.97 }
				}
			}
		}
	}
}

# Task: Surrender Leader
country_event = {
	id = origin.26
	title = TRANSMISSION
	desc = {
		trigger = {
			event_target:scion_master = { NOT = { has_country_flag = fallen_empire_machine } }
		}
		text = "origin.26.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		text = "origin.26.desc.machine"
	}

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = { save_event_target_as = scion_master }
		if = {
			limit = {
				any_owned_leader = {
					is_valid_scion_leader = yes
					has_skill >= 10
				}
			}
			random_owned_leader = {
				limit = {
					is_valid_scion_leader = yes
					has_skill >= 10
				}
				save_event_target_as = desired_leader
			}
		}
		else_if = {
			limit = {
				any_owned_leader = {
					is_valid_scion_leader = yes
					has_skill = 9
				}
			}
			random_owned_leader = {
				limit = {
					is_valid_scion_leader = yes
					has_skill = 9
				}
				save_event_target_as = desired_leader
			}
		}
		else_if = {
			limit = {
				any_owned_leader = {
					is_valid_scion_leader = yes
					has_skill = 8
				}
			}
			random_owned_leader = {
				limit = {
					is_valid_scion_leader = yes
					has_skill = 8
				}
				save_event_target_as = desired_leader
			}
		}
		else_if = {
			limit = {
				any_owned_leader = {
					is_valid_scion_leader = yes
					has_skill = 7
				}
			}
			random_owned_leader = {
				limit = {
					is_valid_scion_leader = yes
					has_skill = 7
				}
				save_event_target_as = desired_leader
			}
		}
		else_if = {
			limit = {
				any_owned_leader = {
					is_valid_scion_leader = yes
					has_skill = 6
				}
			}
			random_owned_leader = {
				limit = {
					is_valid_scion_leader = yes
					has_skill = 6
				}
				save_event_target_as = desired_leader
			}
		}
		else_if = {
			limit = {
				any_owned_leader = {
					is_valid_scion_leader = yes
					has_skill = 5
				}
			}
			random_owned_leader = {
				limit = {
					is_valid_scion_leader = yes
					has_skill = 5
				}
				save_event_target_as = desired_leader
			}
		}
		set_country_flag = scion_requested_leader
	}

	option = {
		name = origin.26.a
		trigger = {
			event_target:scion_master = { NOT = { has_country_flag = fallen_empire_machine } }
		}
		response_text = origin.26.a.response
		custom_tooltip = origin.26.a.tooltip
		custom_tooltip = fallen_empire_happy_tooltip
		hidden_effect = {
			event_target:scion_master = {
				add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }
				clone_leader = {
					target = event_target:desired_leader
				}
			}
			event_target:desired_leader = {
				kill_leader = { show_notification = no }
			}
		}
	}
	option = {
		name = origin.26.a
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		response_text = origin.26.a.response.machine
		custom_tooltip = origin.26.a.tooltip
		custom_tooltip = fallen_machine_empire_happy_tooltip
		hidden_effect = {
			event_target:scion_master = {
				add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }
				clone_leader = {
					target = event_target:desired_leader
				}
			}
			event_target:desired_leader = {
				kill_leader = { show_notification = no }
			}
		}
	}
	option = {
		name = origin.26.b
		trigger = {
			event_target:scion_master = { NOT = { has_country_flag = fallen_empire_machine } }
		}
		response_text = origin.26.b.response
		custom_tooltip = fallen_empire_unhappy_tooltip
		hidden_effect = { event_target:scion_master = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request } } }
	}
	option = {
		name = origin.26.b
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		response_text = origin.26.b.response.machine
		custom_tooltip = fallen_machine_empire_unhappy_tooltip
		hidden_effect = { event_target:scion_master = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request } } }
	}
}

# Reward: Receive Leader
country_event = {
	id = origin.27
	title = TRANSMISSION
	desc = {
		trigger = {
			event_target:scion_master = { NOT = { has_country_flag = fallen_empire_machine } }
		}
		text = "origin.27.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		text = "origin.27.desc.machine"
	}

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = {
			save_event_target_as = scion_master
			owner_species = { save_event_target_as = fe_species }
		}
		set_country_flag = scion_gave_leader
	}

	option = {
		name = origin.27.a
		trigger = {
			event_target:scion_master = { NOT = { has_country_flag = fallen_empire_machine } }
		}
		response_text = origin.27.a.response
		locked_random_list = {
			10 = {
				create_leader = {
					class = admiral
					species = event_target:fe_species
					name = random
					skill = 7
					traits = {
						trait = random_trait
					}
					effect = {
						set_leader_flag = fe_gifted_leader
					}
				}
				custom_tooltip = origin.27.admiral
			}
			10 = {
				create_leader = {
					class = governor
					species = event_target:fe_species
					name = random
					skill = 7
					traits = {
						trait = random_trait
					}
					effect = {
						set_leader_flag = fe_gifted_leader
					}
				}
				custom_tooltip = origin.27.governor
			}
			10 = {
				create_leader = {
					class = scientist
					species = event_target:fe_species
					name = random
					skill = 7
					traits = {
						trait = random_trait
					}
					effect = {
						set_leader_flag = fe_gifted_leader
					}
				}
				custom_tooltip = origin.27.scientist
			}
			10 = {
				create_leader = {
					class = general
					species = event_target:fe_species
					name = random
					skill = 7
					traits = {
						trait = random_trait
					}
					effect = {
						set_leader_flag = fe_gifted_leader
					}
				}
				custom_tooltip = origin.27.general
			}
		}
	}
	option = {
		name = origin.27.a
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		response_text = origin.26.a.response.machine
		locked_random_list = {
			10 = {
				create_leader = {
					class = admiral
					species = event_target:fe_species
					name = random
					skill = 7
					traits = {
						trait = random_trait
					}
					effect = {
						set_leader_flag = fe_gifted_leader
					}
				}
				custom_tooltip = origin.27.admiral
			}
			10 = {
				create_leader = {
					class = governor
					species = event_target:fe_species
					name = random
					skill = 7
					traits = {
						trait = random_trait
					}
					effect = {
						set_leader_flag = fe_gifted_leader
					}
				}
				custom_tooltip = origin.27.governor
			}
			10 = {
				create_leader = {
					class = scientist
					species = event_target:fe_species
					name = random
					skill = 7
					traits = {
						trait = random_trait
					}
					effect = {
						set_leader_flag = fe_gifted_leader
					}
				}
				custom_tooltip = origin.27.scientist
			}
			10 = {
				create_leader = {
					class = general
					species = event_target:fe_species
					name = random
					skill = 7
					traits = {
						trait = random_trait
					}
					effect = {
						set_leader_flag = fe_gifted_leader
					}
				}
				custom_tooltip = origin.27.general
			}
		}
	}
	option = {
		name = origin.27.b
		trigger = {
			is_ai = no
			event_target:scion_master = { NOT = { has_country_flag = fallen_empire_machine } }
		}
		response_text = origin.27.b.response
	}
	option = {
		name = origin.27.b
		trigger = {
			is_ai = no
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		response_text = origin.27.b.response.machine
	}
}

# Reward: Receive Ships
country_event = {
	id = origin.28
	title = TRANSMISSION
	desc = {
		trigger = {
			event_target:scion_master = { NOT = { has_country_flag = fallen_empire_machine } }
		}
		text = "origin.28.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		text = "origin.28.desc.machine"
	}

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = { save_event_target_as = scion_master }
		set_country_flag = scion_gave_ships
	}

	option = {
		name = origin.28.a
		custom_tooltip = origin.28.tooltip
		capital_scope = {
			create_fleet = {
				effect = {
					set_owner = event_target:scion_master # For ship names
					while = {
						count = 1
						create_fallen_empire_large_ship = yes
					}
					while = {
						count = 3
						create_fallen_empire_small_ship = yes
					}
					set_location = {
						target = prev
						distance = 45
						angle = random
					}
					set_owner = root
				}
			}
		}
	}
}

# FE War Intervention
event = {
	id = origin.50
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		any_playable_country = {
			is_scion_subject = yes
			is_at_war = yes
			overlord = { is_at_war = no }
			NOT = { has_country_flag = scion_war_help }
			OR = {
				any_war = {
					any_defender = {
						is_same_value = prevprev
					}
					any_attacker = {
						OR = {
							relative_power = {
								who = prevprev
								category = fleet
								value = overwhelming
							}
							relative_power = {
								who = prevprev
								category = fleet
								value = superior
							}
						}
					}
					defender_war_exhaustion > 0.6
				}
				any_war = {
					any_attacker = {
						is_same_value = prevprev
					}
					any_defender = {
						OR = {
							relative_power = {
								who = prevprev
								category = fleet
								value = overwhelming
							}
							relative_power = {
								who = prevprev
								category = fleet
								value = superior
							}
						}
					}
					attacker_war_exhaustion > 0.6
				}
			}
		}
	}

	immediate = {
		random_playable_country = {
			limit = {
				is_scion_subject = yes
				is_at_war = yes
				overlord = { is_at_war = no }
				NOT = { has_country_flag = scion_war_help }
				OR = {
					any_war = {
						any_defender = {
							is_same_value = prevprev
						}
						any_attacker = {
							OR = {
								relative_power = {
									who = prevprev
									category = fleet
									value = overwhelming
								}
								relative_power = {
									who = prevprev
									category = fleet
									value = superior
								}
							}
						}
						defender_war_exhaustion > 0.6
					}
					any_war = {
						any_attacker = {
							is_same_value = prevprev
						}
						any_defender = {
							OR = {
								relative_power = {
									who = prevprev
									category = fleet
									value = overwhelming
								}
								relative_power = {
									who = prevprev
									category = fleet
									value = superior
								}
							}
						}
						attacker_war_exhaustion > 0.6
					}
				}
			}
			country_event = { id = origin.51 }
		}
	}
}

# Reward: Receive Temporary FE Fleet
country_event = {
	id = origin.51
	title = TRANSMISSION
	desc = {
		trigger = {
			event_target:scion_master = { NOT = { has_country_flag = fallen_empire_machine } }
		}
		text = "origin.51.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		text = "origin.51.desc.machine"
	}

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = {
			save_event_target_as = scion_master
			owner_species = { save_event_target_as = fe_species }
		}
		set_timed_country_flag = { flag = scion_war_help days = 7200 } # 20 year cooldown
	}

	option = {
		name = origin.51.a
		hidden_effect = {
			if = {
				limit = { scion_losing_defensive_war = yes }
				random_country = {
					limit = {
						NOT = { is_same_value = root}
						is_at_war = yes
						is_at_war_with = root
						scion_losing_defensive_war_combatant = yes
						OR = {
							relative_power = {
								who = root
								category = fleet
								value = overwhelming
							}
							relative_power = {
								who = root
								category = fleet
								value = superior
							}
						}
					}
					scion_fe_intervention = yes
				}
			}
			else_if = {
				limit = { scion_losing_offensive_war = yes }
				random_country = {
					limit = {
						NOT = { is_same_value = root}
						is_at_war = yes
						is_at_war_with = root
						scion_losing_offensive_war_combatant = yes
						OR = {
							relative_power = {
								who = root
								category = fleet
								value = overwhelming
							}
							relative_power = {
								who = root
								category = fleet
								value = superior
							}
						}
					}
					scion_fe_intervention = yes
				}

			}
		}
	}
}

# FE Fleet Lost
country_event = {
	id = origin.52
	title = "origin.52.name"
	desc = "origin.52.desc"
	picture = GFX_evt_exploding_ship
	show_sound = event_space_battle

	is_triggered_only = yes

	trigger = {
		fromfrom = { has_fleet_flag = scion_borrowed_fleet }
		exists = overlord
	}

	immediate = {
		overlord = {
			save_event_target_as = scion_master
			owner_species  = { save_event_target_as = fe_species }
		}
		remove_country_flag = borrowed_fleet_from@event_target:scion_master
	}

	option = {
		name = DISCONCERTING
		hidden_effect = {
			country_event = { id = origin.53 days = 5 }
		}
	}
}

# FE Fleet Lost - FE Communication
country_event = {
	id = origin.53
	title = TRANSMISSION
	desc = {
		trigger = {
			event_target:scion_master = {
				NOR = {
					has_country_flag = fallen_empire_3
					has_country_flag = fallen_empire_machine
				}
			}
		}
		text = "origin.53.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_3 }
		}
		text = "origin.53.desc.phile"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		text = "origin.53.desc.machine"
	}

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = { save_event_target_as = scion_master }
	}

	option = {
		name = origin.53.a
	}
}

# FE Fleet Reclaimed (War against Overlord)
country_event = {
	id = origin.29
	title = TRANSMISSION
	desc = {
		trigger = {
			event_target:scion_master = { NOT = { has_country_flag = fallen_empire_machine } }
		}
		text = "origin.29.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		text = "origin.29.desc.machine"
	}

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	trigger = {
		from = {
			using_war_goal = {
                type = wg_independence
                owner = attacker
            }
            any_attacker = { is_same_value = root }
            any_defender = {
            	OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
            }
		}
		any_country = {
			is_at_war_with = root
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
			}
			root = {
				has_country_flag = borrowed_fleet_from@prev
				any_owned_fleet = { has_fleet_flag = scion_borrowed_fleet }
			}
		}
	}

	immediate = {
		random_country = {
			limit = {
				is_at_war_with = root
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
				root = {
					has_country_flag = borrowed_fleet_from@prev
					any_owned_fleet = { has_fleet_flag = scion_borrowed_fleet }
				}
			}
			save_event_target_as = scion_master
		}
		random_owned_fleet = {
			limit = { has_fleet_flag = scion_borrowed_fleet }
			set_owner = event_target:scion_master
		}
		remove_country_flag = borrowed_fleet_from@event_target:scion_master
	}

	option = {
		name = origin.29.a
	}
}

# FE Fleet Reclaimed
country_event = {
	id = origin.54
	title = TRANSMISSION
	desc = {
		trigger = {
			event_target:scion_master = { NOT = { has_country_flag = fallen_empire_machine } }
		}
		text = "origin.54.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_machine }
		}
		text = "origin.54.desc.machine"
	}

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = { save_event_target_as = scion_master }
		random_owned_fleet = {
			limit = { has_fleet_flag = scion_borrowed_fleet }
			leader = {
				kill_leader = { show_notification = no }
			}
			delete_fleet = this
		}
		remove_country_flag = borrowed_fleet_from@event_target:scion_master
	}

	option = {
		name = origin.54.a
		trigger = {
			is_machine_empire = no
		}
	}
	option = {
		trigger = {
			is_machine_empire = yes
		}
		name = origin.10.e
	}
}

# Common Ground/Hegemon Setup
country_event = {
	id = origin.55
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		set_country_flag = first_contact_event
		set_country_flag = Story2 # Already encountered spacefarers
		add_tradition = tr_diplomacy_adopt
		add_tradition = tr_diplomacy_the_federation

		capital_scope = {
			solar_system = {
				closest_system = {
					limit = {
						has_owner = no
						any_system_planet = {
							habitable_planet = yes
						}
					}
					min_steps = 2
					max_steps = 5
					set_star_flag = fed_origin_system_1
					if = {
						limit = {
							any_system_planet = { habitable_planet = yes }
						}
						random_system_planet = {
							limit = { habitable_planet = yes }
							save_event_target_as = fed_planet_1
							set_planet_size = 16
						}
					}
					else = {
						random_system_planet = {
							limit = {
								OR = {
									habitable_planet = yes
									is_planet_class = pc_barren
								}
							}
							save_event_target_as = fed_planet_1
							federation_origin_planet_setup = yes
						}
					}
				}
				if = {
					limit = { NOT = { exists = event_target:fed_planet_1 } }
					closest_system = {
						limit = {
							has_owner = no
							any_system_planet = {
								OR = {
									habitable_planet = yes
									is_planet_class = pc_barren
								}
							}
							OR = {
								is_star_class = sc_f
								is_star_class = sc_g
								is_star_class = sc_k
								is_star_class = sc_m
								is_star_class = sc_binary_6
								is_star_class = sc_binary_7
								is_star_class = sc_binary_8
								is_star_class = sc_trinary_1
								is_star_class = sc_trinary_3
								# Real Space
								is_star_class = sc_binary_f_f
								is_star_class = sc_binary_g_g
								is_star_class = sc_binary_g_k
								is_star_class = sc_binary_m_m
								is_star_class = sc_trinary_f_f_f
								is_star_class = sc_trinary_f_k_m
								is_star_class = sc_trinary_g_m_m
								is_star_class = sc_trinary_g_g_g
								is_star_class = sc_trinary_g_k_k
								is_star_class = sc_trinary_k_k_m
								is_star_class = sc_trinary_k_k_k
								is_star_class = sc_trinary_m_m_m
							}
						}
						min_steps = 2
						set_star_flag = fed_origin_system_1
						if = {
							limit = {
								any_system_planet = { habitable_planet = yes }
							}
							random_system_planet = {
								limit = { habitable_planet = yes }
								save_event_target_as = fed_planet_1
								set_planet_size = 16
							}
						}
						else = {
							random_system_planet = {
								limit = {
									OR = {
										habitable_planet = yes
										is_planet_class = pc_barren
									}
								}
								save_event_target_as = fed_planet_1
								federation_origin_planet_setup = yes
							}
						}
					}
				}
				closest_system = {
					limit = {
						NOT = { has_star_flag = fed_origin_system_1 }
						has_owner = no
						any_system_planet = {
							habitable_planet = yes
						}
					}
					min_steps = 2
					max_steps = 5
					if = {
						limit = {
							any_system_planet = { habitable_planet = yes }
						}
						random_system_planet = {
							limit = { habitable_planet = yes }
							save_event_target_as = fed_planet_2
							set_planet_size = 16
						}
					}
					else = {
						random_system_planet = {
							limit = {
								OR = {
									habitable_planet = yes
									is_planet_class = pc_barren
								}
							}
							save_event_target_as = fed_planet_2
							federation_origin_planet_setup = yes
						}
					}
				}
				if = {
					limit = { NOT = { exists = event_target:fed_planet_2 } }
					closest_system = {
						limit = {
							NOT = { has_star_flag = fed_origin_system_1 }
							has_owner = no
							any_system_planet = {
								OR = {
									habitable_planet = yes
									is_planet_class = pc_barren
								}
							}
							OR = {
								is_star_class = sc_f
								is_star_class = sc_g
								is_star_class = sc_k
								is_star_class = sc_m
								is_star_class = sc_binary_6
								is_star_class = sc_binary_7
								is_star_class = sc_binary_8
								is_star_class = sc_trinary_1
								is_star_class = sc_trinary_3
								# Real Space
								is_star_class = sc_binary_f_f
								is_star_class = sc_binary_g_g
								is_star_class = sc_binary_g_k
								is_star_class = sc_binary_m_m
								is_star_class = sc_trinary_f_f_f
								is_star_class = sc_trinary_f_k_m
								is_star_class = sc_trinary_g_m_m
								is_star_class = sc_trinary_g_g_g
								is_star_class = sc_trinary_g_k_k
								is_star_class = sc_trinary_k_k_m
								is_star_class = sc_trinary_k_k_k
								is_star_class = sc_trinary_m_m_m
							}
						}
						min_steps = 2
						if = {
							limit = {
								any_system_planet = { habitable_planet = yes }
							}
							random_system_planet = {
								limit = { habitable_planet = yes }
								save_event_target_as = fed_planet_2
								set_planet_size = 16
							}
						}
						else = {
							random_system_planet = {
								limit = {
									OR = {
										habitable_planet = yes
										is_planet_class = pc_barren
									}
								}
								save_event_target_as = fed_planet_2
								federation_origin_planet_setup = yes
							}
						}
					}
				}
			}
		}

		# First Member
		event_target:fed_planet_1 = {
			solar_system = { generate_home_system_resources = yes }
			create_species = {
				name = random
				class = random_non_machine
				portrait = random
				traits = random
				homeworld = this
				effect = {
					save_event_target_as = fed_planet_1_species
				}
			}
			if = {
				limit = { root = { has_origin = origin_common_ground } }
				create_common_ground_member_1 = yes
			}
			if = {
				limit = { root = { has_origin = origin_hegemon } }
				create_hegemon_member_1 = yes
			}
			create_colony = {
				owner = event_target:fed_member_1
				species = event_target:fed_planet_1_species
				ethos = owner
			}
			generate_start_deposits_and_blockers = yes
			generate_start_buildings_and_districts = yes
			generate_start_pops = yes
			solar_system = {
				create_starbase = {
					size = starbase_starport
					module = shipyard
					building = crew_quarters
					owner = event_target:fed_member_1
					effect = {
						set_starbase_module = {
							slot = 1
							module = trading_hub
						}
					}
				}
			}
		}

		# Second Member
		event_target:fed_planet_2 = {
			solar_system = { generate_home_system_resources = yes }
			if = {
				limit = {
					ROOT = {
						OR = {
							is_hive_empire = yes
							AND = {
								is_xenophile = yes
								is_authoritarian = yes
							}
						}
						has_origin = origin_common_ground
					}
				}
				create_species = {
					name = random
					class = random_non_machine
					portrait = random
					traits = {
						trait = trait_hive_mind
						trait = random_traits
					}
					homeworld = this
					effect = {
						save_event_target_as = fed_planet_2_species
					}
				}
			}
			else = {
				create_species = {
					name = random
					class = random_non_machine
					portrait = random
					traits = random
					homeworld = this
					effect = {
						save_event_target_as = fed_planet_2_species
					}
				}
			}
			if = {
				limit = { root = { has_origin = origin_common_ground } }
				create_common_ground_member_2 = yes
			}
			if = {
				limit = { root = { has_origin = origin_hegemon } }
				create_hegemon_member_2 = yes
			}
			create_colony = {
				owner = event_target:fed_member_2
				species = event_target:fed_planet_2_species
				ethos = owner
			}
			generate_start_deposits_and_blockers = yes
			generate_start_buildings_and_districts = yes
			generate_start_pops = yes
			solar_system = {
				create_starbase = {
					size = starbase_starport
					module = shipyard
					building = crew_quarters
					owner = event_target:fed_member_2
					effect = {
						set_starbase_module = {
							slot = 1
							module = trading_hub
						}
					}
				}
			}
		}
		event_target:fed_member_1 = {
			create_starting_leaders = yes
			country_event = { id = game_start.9 }
			country_event = { id = game_start.33 days = 1 } # needs delay for system ownership to settle
			join_alliance = { who = root override_requirements = yes }
			set_name = random # Fixes some naming issues
		}
		event_target:fed_member_2 = {
			create_starting_leaders = yes
			country_event = { id = game_start.9 }
			country_event = { id = game_start.33 days = 1 } # needs delay for system ownership to settle
			join_alliance = { who = root override_requirements = yes }
			set_name = random # Fixes some naming issues
		}
		if = {
			limit = { has_origin = origin_common_ground }
			event_target:fed_member_1 = {
				add_opinion_modifier = {
					who = root
					modifier = opinion_common_ground
				}
			}
			event_target:fed_member_2 = {
				add_opinion_modifier = {
					who = root
					modifier = opinion_common_ground
				}
			}
			add_opinion_modifier = {
				who = event_target:fed_member_1
				modifier = opinion_common_ground
			}
			add_opinion_modifier = {
				who = event_target:fed_member_2
				modifier = opinion_common_ground
			}
		}
		if = {
			limit = { has_origin = origin_hegemon }
			federation = {
				set_federation_type = hegemony_federation
				set_name = random
				set_federation_law = succession_term_years_20
			}
		}
		federation = { add_federation_experience = 2000 }
		set_federation_leader = root
	}
}

############
#  Origin  #  -  Galactic Doorstep Origin
############

# Stage 4 - The Gatekeeper Memoirs
fleet_event = {
	id = origin.1115
	title = "origin.1115.name"
	desc = "origin.1115.desc"
	picture = GFX_evt_star_chart
	show_sound = event_collapsing_ruins

	archaeology = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = FASCINATING
		medium_artifact_reward = yes
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
		hidden_effect = {
			owner = { country_event = { id = origin.1013 days = 10 } }
		}
	}
}

# Galactic Doorstep - Return to Sender
country_event = {
	id = origin.1020
	title = "origin.1020.name"
	desc = {
		text = "origin.1020.desc"
		trigger = {
			NOT = { has_authority = auth_machine_intelligence }
		}
	}
	desc = {
		text = "origin.1020.desc.machine"
		trigger = {
			has_authority = auth_machine_intelligence
		}
	}
	picture = GFX_evt_space_debris
	show_sound = event_energy_field
	location = event_target:doorstep_gateway
	
	is_triggered_only = yes

	immediate = {
	}

	option = {
		name = INTRIGUING
		owner = {
			if = {
				limit = {
					has_tech_option = tech_gateway_activation
				}
				add_tech_progress = {
					tech = tech_gateway_activation
					progress = 0.85
				}
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_gateway_activation }
				}
				add_research_option = tech_gateway_activation
				add_tech_progress = {
					tech = tech_gateway_activation
					progress = 0.65
				}
			}
			else = {
				add_monthly_resource_mult = {
     				resource = engineering_research
     				value = @tier4researchreward
     				min = @tier4researchmin
     				max = @tier4researchmax
     			}
     			add_monthly_resource_mult = {
     				resource = physics_research
     				value = @tier4researchreward
     				min = @tier4researchmin
     				max = @tier4researchmax
     			}
			}
		}
		hidden_effect = {
			country_event = { id = origin.1021 days = 1200 random = 100 }
		}
	}
}

country_event = {
	id = origin.1050
	title = origin.1050.name
	desc = origin.1050.desc
	picture = GFX_evt_drifting_gateway
	show_sound = event_default
	location = from
	
	is_triggered_only = yes

	trigger = {
		has_origin = origin_galactic_doorstep
		NOT = { has_technology = tech_gateway_construction }
		NOT = { has_tech_option = tech_gateway_construction }
		fromfromfrom = { has_megastructure_flag = doorstep_gateway@root }
		NOR = {
			has_country_flag = gateway_reactivated
			has_country_flag = gateway_built
		}
	}

	immediate = {
		set_country_flag = gateway_reactivated
	}

	option = {
		name = origin.1050.A

		if = {
			limit = {
				NOR = {
					has_tech_option = tech_gateway_construction
					has_technology = tech_gateway_construction
				}
			}
			add_research_option = tech_gateway_construction
			add_tech_progress = {
				tech = tech_gateway_construction
				progress = 0.50
			}
		}
		else_if = {
			limit = { has_tech_option = tech_gateway_construction }
			add_tech_progress = {
				tech = tech_gateway_construction
				progress = 0.65
			}
		}
		add_resource = { nanites = 150 }
	}
}

############
# Origin # - On the Shoulders of Giants Origin
############

### Origin - On the Shoulders of Giants Origin - Archaeology: Ex Gravitas

# Stage 4 - Wind Back and Proceed
fleet_event = {
	id = origin.1215
	title = "origin.1215.name"
	desc = {
		trigger = {
			 owner = { has_country_flag = arc_site_moon }
		}
		text = origin.1215.desc.a
	}
	desc = {
		trigger = {
			 owner = { has_country_flag = arc_site_planet }
		}
		text = origin.1215.desc.b
	}
	picture = GFX_evt_clocks
	show_sound = event_mystic_reveal

	archaeology = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
		owner = {
			remove_country_flag = arc_site_moon
			remove_country_flag = arc_site_planet
		}
	}

	option = {
		name = AMAZING
		owner = {
			add_monthly_resource_mult = {
				resource = minerals
				value = @tier2materialreward
				min = @tier2materialmin
				max = @tier2materialmax
			}
			add_random_research_option = {
				add_progress = 0.85
				area = physics
				category = computing
				tier = 1
				ignore_prereqs = yes
				fail_effects = {
					add_random_research_option = {
						add_progress = 0.5
						area = physics
						category = computing
						tier = 2
						ignore_prereqs = yes
						fail_effects = {
							add_monthly_resource_mult = {
								resource = physics_research
								value = @tier5researchreward
								min = @tier5researchmin
								max = @tier5researchmax
							}
						}
					}
				}
			}
		}
		hidden_effect = {
			owner = {
				country_event = { id = origin.1219 days = 3 random = 1 }
			}
		}
	}
}

### Origin - On the Shoulders of Giants Origin - Archaeology: Something Waiting
# Stage 4 - Full of Wonders
fleet_event = {
	id = origin.1235
	title = "origin.1235.name"
	desc = "origin.1235.desc"
	picture = GFX_evt_star_chart
	show_sound = event_alien_signal

	archaeology = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = FASCINATING
		small_artifact_reward = yes
		owner = {
			locked_random_list = {
				10 = {
					add_random_research_option = {
						add_progress = 0.85
						area = engineering
						tier = 1
						ignore_prereqs = yes
						fail_effects = {
							add_random_research_option = {
								add_progress = 0.5
								area = engineering
								tier = 2
								ignore_prereqs = yes
								fail_effects = {
									add_monthly_resource_mult = {
										resource = engineering_research
										value = @tier5researchreward
										min = @tier5researchmin
										max = @tier5researchmax
									}
								}
							}
						}
					}
				}
				10 = {
					add_random_research_option = {
						add_progress = 0.85
						area = physics
						tier = 1
						ignore_prereqs = yes
						fail_effects = {
							add_random_research_option = {
								add_progress = 0.5
								area = physics
								tier = 2
								ignore_prereqs = yes
								fail_effects = {
									add_monthly_resource_mult = {
										resource = physics_research
										value = @tier5researchreward
										min = @tier5researchmin
										max = @tier5researchmax
									}
								}
							}
						}
					}
				}
				10 = {
					add_random_research_option = {
						add_progress = 0.85
						area = society
						tier = 1
						ignore_prereqs = yes
						fail_effects = {
							add_random_research_option = {
								add_progress = 0.5
								area = society
								tier = 2
								ignore_prereqs = yes
								fail_effects = {
									add_monthly_resource_mult = {
										resource = society_research
										value = @tier5researchreward
										min = @tier5researchmin
										max = @tier5researchmax
									}
								}
							}
						}
					}
				}
			}
		}
		hidden_effect = {
			owner = {
				country_event = { id = origin.1239 days = 3 random = 1 }
			}
		}
	}
}

### Origin - On the Shoulders of Giants Origin - Archaeology: Buried Deep
# Stage 2 - Bunker Debunked
fleet_event = {
	id = origin.1245
	title = "origin.1245.name"
	desc = "origin.1245.desc"
	picture = GFX_evt_resource_cache
	show_sound = event_structural_collapse

	archaeology = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = EXCELLENT
		small_artifact_reward = yes
		owner = {
			locked_random_list = {
				10 = {
					add_random_research_option = {
						add_progress = 0.85
						area = engineering
						tier = 1
						ignore_prereqs = yes
						fail_effects = {
							add_random_research_option = {
								add_progress = 0.5
								area = engineering
								tier = 2
								ignore_prereqs = yes
								fail_effects = {
									add_monthly_resource_mult = {
										resource = engineering_research
										value = @tier5researchreward
										min = @tier5researchmin
										max = @tier5researchmax
									}
								}
							}
						}
					}
				}
				10 = {
					add_random_research_option = {
						add_progress = 0.85
						area = physics
						tier = 1
						ignore_prereqs = yes
						fail_effects = {
							add_random_research_option = {
								add_progress = 0.5
								area = physics
								tier = 2
								ignore_prereqs = yes
								fail_effects = {
									add_monthly_resource_mult = {
										resource = physics_research
										value = @tier5researchreward
										min = @tier5researchmin
										max = @tier5researchmax
									}
								}
							}
						}
					}
				}
				10 = {
					add_random_research_option = {
						add_progress = 0.85
						area = society
						tier = 1
						ignore_prereqs = yes
						fail_effects = {
							add_random_research_option = {
								add_progress = 0.5
								area = society
								tier = 2
								ignore_prereqs = yes
								fail_effects = {
									add_monthly_resource_mult = {
										resource = society_research
										value = @tier5researchreward
										min = @tier5researchmin
										max = @tier5researchmax
									}
								}
							}
						}
					}
				}
			}
		}
		hidden_effect = {
			owner = {
				country_event = { id = origin.1249 days = 3 random = 1 }
			}
		}
	}
}

### Origin - On the Shoulders of Giants Origin - Archaeology: In Memoriam
# Stage 4 - Addendum
fleet_event = {
	id = origin.1265
	title = "origin.1265.name"
	desc = "origin.1265.desc"
	picture = GFX_evt_ancient_artifact
	show_sound = event_alien_signal

	archaeology = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = origin.1265.a
		small_artifact_reward = yes
		owner = {
			locked_random_list = {
				10 = {
					add_random_research_option = {
						add_progress = 0.85
						area = engineering
						tier = 1
						ignore_prereqs = yes
						fail_effects = {
							add_random_research_option = {
								add_progress = 0.5
								area = engineering
								tier = 2
								ignore_prereqs = yes
								fail_effects = {
									add_monthly_resource_mult = {
										resource = engineering_research
										value = @tier5researchreward
										min = @tier5researchmin
										max = @tier5researchmax
									}
								}
							}
						}
					}
				}
				10 = {
					add_random_research_option = {
						add_progress = 0.85
						area = physics
						tier = 1
						ignore_prereqs = yes
						fail_effects = {
							add_random_research_option = {
								add_progress = 0.5
								area = physics
								tier = 2
								ignore_prereqs = yes
								fail_effects = {
									add_monthly_resource_mult = {
										resource = physics_research
										value = @tier5researchreward
										min = @tier5researchmin
										max = @tier5researchmax
									}
								}
							}
						}
					}
				}
				10 = {
					add_random_research_option = {
						add_progress = 0.85
						area = society
						tier = 1
						ignore_prereqs = yes
						fail_effects = {
							add_random_research_option = {
								add_progress = 0.5
								area = society
								tier = 2
								ignore_prereqs = yes
								fail_effects = {
									add_monthly_resource_mult = {
										resource = society_research
										value = @tier5researchreward
										min = @tier5researchmin
										max = @tier5researchmax
									}
								}
							}
						}
					}
				}
			}
		}
		hidden_effect = {
			owner = {
				country_event = { id = origin.1269 days = 3 random = 1 }
			}
		}
	}
}

### Origin - On the Shoulders of Giants Origin - Archaeology: The Last Stand
# Stage 3 - Crescendo!
fleet_event = {
	id = origin.1280
	title = "origin.1280.name"
	desc = "origin.1280.desc"
	picture = GFX_evt_space_funeral
	show_sound = event_ship_thrusters

	archaeology = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		from = { save_event_target_as = the_last_stand_stage_3 }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = origin.1280.a
		small_artifact_reward = yes
		owner = {
			locked_random_list = {
				10 = {
					add_random_research_option = {
						add_progress = 0.85
						area = engineering
						tier = 1
						ignore_prereqs = yes
						fail_effects = {
							add_random_research_option = {
								add_progress = 0.5
								area = engineering
								tier = 2
								ignore_prereqs = yes
								fail_effects = {
									add_monthly_resource_mult = {
										resource = engineering_research
										value = @tier5researchreward
										min = @tier5researchmin
										max = @tier5researchmax
									}
								}
							}
						}
					}
				}
				10 = {
					add_random_research_option = {
						add_progress = 0.85
						area = physics
						tier = 1
						ignore_prereqs = yes
						fail_effects = {
							add_random_research_option = {
								add_progress = 0.5
								area = physics
								tier = 2
								ignore_prereqs = yes
								fail_effects = {
									add_monthly_resource_mult = {
										resource = physics_research
										value = @tier5researchreward
										min = @tier5researchmin
										max = @tier5researchmax
									}
								}
							}
						}
					}
				}
				10 = {
					add_random_research_option = {
						add_progress = 0.85
						area = society
						tier = 1
						ignore_prereqs = yes
						fail_effects = {
							add_random_research_option = {
								add_progress = 0.5
								area = society
								tier = 2
								ignore_prereqs = yes
								fail_effects = {
									add_monthly_resource_mult = {
										resource = society_research
										value = @tier5researchreward
										min = @tier5researchmin
										max = @tier5researchmax
									}
								}
							}
						}
					}
				}
			}
		}
		event_target:the_last_stand_stage_3 = { add_stage_clues = 3 }
	}
}

# Stage 4 - Aftermath
fleet_event = {
	id = origin.1285
	title = "origin.1285.name"
	desc = "origin.1285.desc"
	picture = GFX_evt_ship_offloading_cargo
	show_sound = event_mystic_reveal

	archaeology = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = PECULIAR
		medium_artifact_reward = yes

		hidden_effect = {
			owner = {
				country_event = { id = origin.1289 days = 3 random = 1 }
			}
		}
	}
}

### Origin - On the Shoulders of Giants Origin - Archaeology: Dark Secret

# Stage 4 - Tyrant's Remorse (Part II)
fleet_event = {
	id = origin.1310
	title = "origin.1310.name"
	desc = "origin.1310.desc"
	picture = GFX_evt_alien_cavemen
	show_sound = event_mystic_reveal

	archaeology = yes
	is_triggered_only = yes

	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}

	after = {
		fromfrom = { set_site_progress_locked = no }
		owner = {
			remove_country_flag = dark_secret_tyrant
		}
	}

	option = {
		name = origin.1310.a
		small_artifact_reward = yes
		owner = {
			if = {
				limit = { is_gestalt = no }
				add_modifier = {
					modifier = spurred_by_the_past
					days = -1
				}
			}
			else = {
				add_modifier = {
					modifier = spurred_by_the_past_gest
					days = -1
				}
			}
			hidden_effect = {
				set_country_flag = relentless_pursuit
			}
		}
	}
}

# Stage 4 - Next Step (generic ending text)
fleet_event = {
	id = origin.1330
	title = "origin.1330.name"
	desc = "origin.1330.desc"
	picture = GFX_evt_huge_monument
	show_sound = event_mystic_reveal

	archaeology = yes
	is_triggered_only = yes

	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}

	after = {
		fromfrom = { set_site_progress_locked = no }
	}

	option = {
		name = origin.1330.a
		small_artifact_reward = yes
		owner = {
			if = {
				limit = { is_gestalt = no }
				add_modifier = {
					modifier = spurred_by_the_past
					days = -1
				}
			}
			else = {
				add_modifier = {
					modifier = spurred_by_the_past_gest
					days = -1
				}
			}
			hidden_effect = {
				if = {
					limit = {
						has_country_flag = godspeed_outcome
					}
					set_country_flag = relentless_pursuit
				}
				else = {
					set_country_flag = intercepting_history
				}
			}
		}
	}
}

### Origin - On the Shoulders of Giants Origin - Archaeology: Benign Cover-Up
# Stage 2 - Step 1 went smoothly
fleet_event = {
	id = origin.1370
	title = "origin.1370.name"
	desc = "origin.1370.desc"
	picture = GFX_evt_resource_cache
	show_sound = event_construction

	archaeology = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = origin.1370.a
		medium_artifact_reward = yes
		owner = {
			hidden_effect = {
				owner = {
					country_event = { id = origin.1360 days = 10 }
				}
			}
		}
	}
}

############
# Origin # - On the Shoulders of Giants CONTINUED Origin
############			INTERCEPTING HISTORY Event Chain

# On the Shoulders of Giants CONTINUED - Event 9 - Closure
country_event = {
	id = origin.1360
	title = "origin.1360.name"
	desc = "origin.1360.desc"
	picture = GFX_evt_unity_symbol
	show_sound = event_mystic_reveal

	is_triggered_only = yes

	immediate = {
	}

	after = {
		clear_global_event_target = benefactor_planet
		clear_global_event_target = benefactor_homeworld
	}

	option = {
		name = origin.1360.a
		owner = {
			if = {
				limit = { is_gestalt = no }
				add_modifier = {
					modifier = full_circle
					days = -1
				}
			}
			else = {
				add_modifier = {
					modifier = full_circle_gest
					days = -1
				}
			}
			hidden_effect = {
				end_event_chain = intercepting_history_chain
				remove_modifier = spurred_by_the_past
				remove_modifier = spurred_by_the_past_gest
			}
		}
	}
}

############
# Origin # - On the Shoulders of Giants CONTINUED Origin
############			RELENTLESS PURSUIT Event Chain

# On the Shoulders of Giants CONTINUED - Event 9 - Not the Enemy
country_event = {
	id = origin.1420
	title = "origin.1420.name"
	desc = "origin.1420.desc"
	picture = GFX_evt_unity_symbol
	show_sound = event_default

	is_triggered_only = yes

	immediate = {
	}

	after = {
	}

	option = {
		name = EXCELLENT
		owner = {
			if = {
				limit = { is_gestalt = no }
				add_modifier = {
					modifier = goes_around_comes_around
					days = -1
				}
			}
			else = {
				add_modifier = {
					modifier = goes_around_comes_around_gest
					days = -1
				}
			}
			hidden_effect = {
				end_event_chain = relentless_pursuit_chain
				remove_modifier = spurred_by_the_past
				remove_modifier = spurred_by_the_past_gest
			}
		}
	}
}

# On the Shoulders of Giants CONTINUED - Relentless Pursuit Event Chain - Arc Site
# Stage 2 - Interstellar Geo-Caching
fleet_event = {
	id = origin.1415
	title = "origin.1415.name"
	desc = "origin.1415.desc"
	picture = GFX_evt_resource_cache
	show_sound = event_construction

	archaeology = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
		clear_global_event_target = relentless_planet
		clear_global_event_target = relentless_homeworld
	}

	option = {
		name = OK
		medium_artifact_reward = yes
		owner = {
			hidden_effect = {
				owner = {
					country_event = { id = origin.1420 days = 3 }
				}
			}
		}
	}
}

############
# Tree of Life
############

#Add ToL to new colonies
planet_event = {
	id = origin.3001
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		owner = {
			OR = {
				has_origin = origin_tree_of_life
				has_origin = origin_sacred_tree
				has_origin = origin_master_computer
			}
		}
	}

	immediate = {
		if = {
			limit = {
				owner = {
					OR = {
						has_origin = origin_tree_of_life
						has_origin = origin_sacred_tree
					}
				}
			}
			add_deposit = d_tree_of_life_colony
			remove_modifier = no_lifetree #as the planet transfer events fire before this
			remove_modifier = no_lifetree_sacred #as the planet transfer events fire before this
			if = {
				limit = { owner = { has_origin = origin_sacred_tree } }
				spawn_caretaker_effect = yes
			}
		}
		else_if = {
			limit = { owner = { has_origin = origin_master_computer } }
			add_deposit = d_master_computer_colony
			remove_modifier = no_master_computer
		}
	}
}

#informatively kill tree
planet_event = {
	id = origin.3003
	title = "origin.3003.name"
	desc = "origin.3003.desc"
	picture = GFX_evt_burning_city
	show_sound = event_alien_nature

	is_triggered_only = yes

	trigger = {
		planet_devastation >= 50
		OR = {
			has_deposit = d_tree_of_life_colony
			has_deposit = d_tree_of_life_home
		}
	}

	immediate = {
		remove_deposit = d_tree_of_life_colony
		remove_deposit = d_tree_of_life_home
		owner = {
			remove_country_flag = tree_of_life_destroyed
			set_timed_country_flag = { flag = tree_of_life_destroyed days = 7200 } # protect the tree of life demand
			if = {
				limit = { has_origin = origin_sacred_tree }
				add_modifier = { modifier = tree_failed_protector days = 7200 }
			}
		}
	}

	option = {
		name = UNFORTUNATE
		tooltip = {
			remove_deposit = d_tree_of_life_colony
			remove_deposit = d_tree_of_life_home
		}
		if = {
			limit = { owner = { has_origin = origin_tree_of_life } }
			add_modifier = { modifier = no_lifetree }
		}
		else_if = {
			limit = { owner = { has_origin = origin_sacred_tree } }
			add_modifier = { modifier = no_lifetree_sacred }
		}
	}
}

#modify the modifier for lacking Tree
planet_event = {
	id = origin.3004
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		OR = {
			AND = {
				FROM = { has_origin = origin_tree_of_life }
				NOR = {
					has_deposit = d_tree_of_life_colony
					has_deposit = d_tree_of_life_home
					has_modifier = no_lifetree
				}
			}
			AND = {
				FROM = { has_origin = origin_sacred_tree }
				NOR = {
					has_deposit = d_tree_of_life_colony
					has_deposit = d_tree_of_life_home
					has_modifier = no_lifetree_sacred
				}
			}
			AND = {
				FROM = { NOT = { has_origin = origin_tree_of_life } }
				has_modifier = no_lifetree
			}
			AND = {
				FROM = { NOT = { has_origin = origin_sacred_tree } }
				has_modifier = no_lifetree_sacred
			}
			AND = {
				FROM = { has_origin = origin_master_computer }
				NOR = {
					has_deposit = d_master_computer
					has_deposit = d_master_computer_colony
					has_modifier = no_master_computer
				}
			}
			AND = {
				FROM = { NOT = { has_origin = origin_master_computer } }
				has_modifier = no_master_computer
			}
		}

	}

	immediate = {
		if = {
			limit = {
				FROM = { has_origin = origin_tree_of_life }
				NOR = {
					has_deposit = d_tree_of_life_colony
					has_deposit = d_tree_of_life_home
				}
			}
			remove_modifier = no_lifetree_sacred
			remove_modifier = no_master_computer
			add_modifier = { modifier = no_lifetree }
		}
		else_if = {
			limit = {
				FROM = { has_origin = origin_sacred_tree }
				NOR = {
					has_deposit = d_tree_of_life_colony
					has_deposit = d_tree_of_life_home
				}
			}
			remove_modifier = no_lifetree
			remove_modifier = no_master_computer
			add_modifier = { modifier = no_lifetree_sacred }
		}
		else_if = {
			limit = {
				FROM = { has_origin = origin_master_computer }
				NOR = {
					has_deposit = d_master_computer
					has_deposit = d_master_computer_colony
				}
			}
			remove_modifier = no_lifetree
			remove_modifier = no_lifetree_sacred
			add_modifier = { modifier = no_master_computer }
		}
		else = {
			remove_modifier = no_lifetree
			remove_modifier = no_lifetree_sacred
			remove_modifier = no_master_computer
		}
	}
}

#Lithoid origin
planet_event = {
	id = origin.3010
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		habitable_structure = no
		exists = FROM
		FROM = { is_ship_size = lithoid_colonizer }
	}

	immediate = {
		add_deposit = d_buried_lithoids
		add_deposit = d_buried_lithoids
		add_colony_progress = 0.25
		add_planet_devastation = 100
		if = {
			limit = { NOT = { has_deposit = d_lithoid_crater_colony } }
			add_deposit = d_lithoid_crater_colony
		}
		if = {
			limit = { NOT = { has_modifier = lithoid_crater } }
			add_modifier = { modifier = lithoid_crater }
		}
	}
}

### Remnants ###
country_event = {
	id = origin.3100
	title = "origin.3100.name"
	desc = "origin.3100.desc"
	picture = GFX_evt_relic_world
	show_sound = event_alien_nature

	is_triggered_only = yes

	immediate = {
	}

	option = {
		name = EXCELLENT
		locked_random_list = {
			10 = {
				add_random_research_option = {
					add_progress = 0.95
					area = engineering
					tier = 1
					ignore_prereqs = yes
					fail_effects = {
						add_random_research_option = {
							add_progress = 0.6
							area = engineering
							tier = 2
							ignore_prereqs = yes
							fail_effects = {
								add_random_research_option = {
									add_progress = 0.3
									area = engineering
									tier = 3
									ignore_prereqs = yes
									fail_effects = {
										add_monthly_resource_mult = {
											resource = engineering_research
											value = @tier5researchreward
											min = @tier5researchmin
											max = @tier5researchmax
										}
									}
								}
							}
						}
					}
				}
			}
			10 = {
				add_random_research_option = {
					add_progress = 0.95
					area = physics
					tier = 1
					ignore_prereqs = yes
					fail_effects = {
						add_random_research_option = {
							add_progress = 0.6
							area = physics
							tier = 2
							ignore_prereqs = yes
							fail_effects = {
								add_random_research_option = {
									add_progress = 0.3
									area = physics
									tier = 3
									ignore_prereqs = yes
									fail_effects = {
										add_monthly_resource_mult = {
											resource = physics_research
											value = @tier5researchreward
											min = @tier5researchmin
											max = @tier5researchmax
										}
									}
								}
							}
						}
					}
				}
			}
			10 = {
				add_random_research_option = {
					add_progress = 0.95
					area = society
					tier = 1
					ignore_prereqs = yes
					fail_effects = {
						add_random_research_option = {
							add_progress = 0.6
							area = society
							tier = 2
							ignore_prereqs = yes
							fail_effects = {
								add_random_research_option = {
									add_progress = 0.3
									area = society
									tier = 3
									ignore_prereqs = yes
									fail_effects = {
										add_monthly_resource_mult = {
											resource = society_research
											value = @tier5researchreward
											min = @tier5researchmin
											max = @tier5researchmax
										}
									}
								}
							}
						}
					}
				}
			}
			10 = {
				add_random_research_option = {
					add_progress = 0.6
					area = engineering
					tier = 2
					ignore_prereqs = yes
					fail_effects = {
						add_random_research_option = {
							add_progress = 0.3
							area = engineering
							tier = 3
							ignore_prereqs = yes
							fail_effects = {
								add_monthly_resource_mult = {
									resource = engineering_research
									value = @tier5researchreward
									min = @tier5researchmin
									max = @tier5researchmax
								}
							}
						}
					}
				}
			}
			10 = {
				add_random_research_option = {
					add_progress = 0.6
					area = physics
					tier = 2
					ignore_prereqs = yes
					fail_effects = {
						add_random_research_option = {
							add_progress = 0.3
							area = physics
							tier = 3
							ignore_prereqs = yes
							fail_effects = {
								add_monthly_resource_mult = {
									resource = physics_research
									value = @tier5researchreward
									min = @tier5researchmin
									max = @tier5researchmax
								}
							}
						}
					}
				}
			}
			10 = {
				add_random_research_option = {
					add_progress = 0.6
					area = society
					tier = 2
					ignore_prereqs = yes
					fail_effects = {
						add_random_research_option = {
							add_progress = 0.3
							area = society
							tier = 3
							ignore_prereqs = yes
							fail_effects = {
								add_monthly_resource_mult = {
									resource = society_research
									value = @tier5researchreward
									min = @tier5researchmin
									max = @tier5researchmax
								}
							}
						}
					}
				}
			}
			10 = {
				add_random_research_option = {
					add_progress = 0.3
					area = engineering
					tier = 3
					ignore_prereqs = yes
					fail_effects = {
						add_monthly_resource_mult = {
							resource = engineering_research
							value = @tier5researchreward
							min = @tier5researchmin
							max = @tier5researchmax
						}
					}
				}
			}
			10 = {
				add_random_research_option = {
					add_progress = 0.3
					area = physics
					tier = 3
					ignore_prereqs = yes
					fail_effects = {
						add_monthly_resource_mult = {
							resource = physics_research
							value = @tier5researchreward
							min = @tier5researchmin
							max = @tier5researchmax
						}
					}
				}
			}
			10 = {
				add_random_research_option = {
					add_progress = 0.3
					area = society
					tier = 3
					ignore_prereqs = yes
					fail_effects = {
						add_monthly_resource_mult = {
							resource = society_research
							value = @tier5researchreward
							min = @tier5researchmin
							max = @tier5researchmax
						}
					}
				}
			}
		}
	}
}

planet_event = {
	id = origin.3101
	title = "origin.3101.name"
	desc = "origin.3101.desc"
	picture = GFX_evt_overgrown_city
	show_sound = event_alien_nature

	is_triggered_only = yes
	
	trigger = {
		owner = { 
			has_origin = origin_remnants
		} 
		has_planet_flag = colonial_remains@root.owner
	}

	option = {
		name = EXCELLENT
		add_modifier = { modifier = colonial_remains }
		add_deposit = d_ruined_arcology
		hidden_effect = { #maybe add a random blocker to hint at why the colony was lost
			random_list = {
				5 = { add_deposit = d_radioactive_wasteland }
				5 = { add_deposit = d_city_ruins }
				5 = { add_deposit = d_crater }
				5 = { add_deposit = d_mutant_landfill }
				5 = { add_deposit = d_ancient_bombardment_craters }
				5 = { add_deposit = d_ancient_battlefield }
				5 = { add_deposit = d_impact_crater }
				5 = { add_deposit = d_ancient_particle_accelerator }
				5 = { add_deposit = d_harvester_fields }
				5 = { add_deposit = d_organic_landfill }
				5 = { add_deposit = d_ancient_mining_site }
				5 = { add_deposit = d_metal_boneyard }
				3 = { add_deposit = d_irradiated_valley }
				3 = { add_deposit = d_underground_vault_2 }
				1 = { add_deposit = d_organic_slurry }
				1 = { add_deposit = d_odd_factory }
				1 = { add_deposit = d_toy_factory_complex }
				1 = {
					add_modifier = {
						modifier = "cunning_flora"
						days = -1
					}
					add_deposit = d_savage_wildlands
					add_deposit = d_dense_jungle
				}
			}
		}
	}
}

#########################
# SLINGSHOT TO THE STARS
#########################

# Digsite Events
fleet_event = {
	id = origin.3515
	title = "origin.3515.name"
	desc = "origin.3515.desc"
	picture = GFX_evt_baol_datacrystals
	show_sound = event_dig_site

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = origin.3515.a
		small_artifact_reward = yes
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

fleet_event = {
	id = origin.3520
	title = "origin.3520.name"
	desc = "origin.3520.desc"
	picture = GFX_evt_baol_datacrystals
	show_sound = event_dig_site

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = INTRIGUING
		small_artifact_reward = yes
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

fleet_event = {
	id = origin.3525
	title = "origin.3525.name"
	desc = "origin.3525.desc"
	picture = GFX_evt_baol_datacrystals
	show_sound = event_dig_site

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = origin.3515.a
		small_artifact_reward = yes
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

fleet_event = {
	id = origin.3530
	title = "origin.3530.name"
	desc = "origin.3530.desc"
	picture = GFX_evt_baol_datacrystals
	show_sound = event_dig_site

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = FASCINATING
		small_artifact_reward = yes
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

fleet_event = {
	id = origin.3535
	title = "origin.3535.name"
	desc = "origin.3535.desc"
	picture = GFX_evt_baol_datacrystals
	show_sound = event_dig_site

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = origin.3515.a
		small_artifact_reward = yes
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

fleet_event = {
	id = origin.3540
	title = "origin.3540.name"
	desc = "origin.3540.desc"
	picture = GFX_evt_slingshot_stars
	show_sound = evn_ove_slingshot_stars

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = origin.3540.a
		medium_artifact_reward = yes
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier5researchreward
				min = @tier5researchmin
				max = @tier5researchmax
			}
		}
		owner = {
			if = {
				limit = {
					NOT = { has_technology = tech_mega_engineering }
				}
				add_modifier = {
					modifier = infinity_beckons
					days = 18000
				}
			}
		}
	}
}

##################
# IMPERIAL VASSAL
##################

## Overlord Dissolution Events
# Pre-Event
country_event = { # Overlord
	id = origin.5715

	hide_window = yes
	is_triggered_only = yes

	trigger = {
		always = no
		#has_origin = origin_imperial_vassal_overlord
		#years_passed >= 35
	}

	immediate = {
		#country_event = {
		#	id = origin.5720
		#	days = 1825
		#	random = 9125
		#}
	}
}

# Previous Leader dies, succession crisis
country_event = { # Overlord version
	id = origin.5720
	
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_origin = origin_imperial_vassal_overlord
		years_passed >= 35
		heir = {
			NOR = {
				has_trait = trait_ruler_recruiter
				has_trait = trait_ruler_deep_connections
				has_trait = trait_ruler_charismatic
				has_trait = trait_ruler_champion_of_the_people
				has_trait = leader_trait_reformer
				has_trait = leader_trait_ruler_chosen
			}
		}
		from = {
			is_same_value = root.ruler
		}
	}

	immediate = {
		heir = {
			save_event_target_as = overlord_heir
		}
		ruler = {
			save_event_target_as = overlord_ruler
		}
		country_event = {
			id = origin.5730
			days = 365
			random = 1825
		}
		every_subject = {
			country_event = {
				id = origin.5725
			}
		}
	}
}

# Dissolution of the Empire
country_event = { # Overlord Version
	id = origin.5730
	
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_origin = origin_imperial_vassal_overlord
		ruler = {
			NOR = {
				has_trait = trait_ruler_recruiter
				has_trait = trait_ruler_deep_connections
				has_trait = trait_ruler_charismatic
				has_trait = trait_ruler_champion_of_the_people
				has_trait = leader_trait_reformer
				has_trait = leader_trait_ruler_chosen
			}
		}
	}

	immediate = {
		save_event_target_as = previous_overlord
		set_country_flag = origin_imperial_vassal_ex_overlord
		set_origin = origin_default
		change_government = {
			authority = auth_dictatorial
			civics = random
		}
		every_subject = { # Release and notify current subjects
			set_subject_of = { who = none }
			country_event = { id = origin.5735 }
		}
		while = { # iterate through all splintering worlds
			limit = { any_owned_planet = { is_capital = no } }
			random_system_within_border = { # we want a country per colonized system
				limit = { is_capital_system = no }
				random_system_planet = {
					limit = { is_colony = yes }
					create_country = {
						name = random
						type = default
						authority = random
						civics = random
						species = root.species
						ethos = random
						origin = origin_default
						day_zero_contact = no
						effect = {
							set_country_flag = origin_imperial_vassal_ex_overlord
							set_country_flag = origin_imperial_vassal_ex_overlord@event_target:previous_overlord # also unique in case of MP (while the overlord survives...)
							set_timed_country_flag = { flag = day_0 days = 7 } # suppresses the contact events, but not notifications
							save_event_target_as = current_splinter

							every_playable_country = { # Establish Contact with previous vassals
								limit = {
									has_communications = root
									NOT = { has_communications = event_target:current_splinter }
								}
								establish_communications_no_message = event_target:current_splinter
							}
							every_playable_country = {
								limit = {
									NOT = { has_communications = root }
									has_active_first_contact_with = root
								}
								establish_contact = {
									who = event_target:current_splinter
									location = event_target:current_splinter.capital_star
								}
							}

							root = { # Give them one of the previous Overlord's fleets
								random_owned_fleet = {
									set_owner = event_target:current_splinter
								}
							}

							# Give them a fleet of their own
							create_fleet = {
								effect = {
									set_owner = event_target:current_splinter
									while = {
										count = 10
										create_ship = {
											name = random
											design = NAME_Ravager
										}
									}
									set_location = event_target:current_splinter.capital_star
								}
							}

							# Give them some starting resources
							add_basic_resources_effect = { VALUE = 3000 }
							add_manufactured_resources_effect = { VALUE = 1500 }
							add_advanced_resources_effect = { VALUE = 1000 }

							declare_war = { # Start a war with the previous Overlord
								target = root
								name = {
									key = "NAME_Imperial_War"
								}
								attacker_war_goal = wg_subjugation
							}
						}
					}
					set_owner = event_target:current_splinter
				}
				starbase = { set_owner = event_target:current_splinter }
			}
		}
	}
}