namespace = eo_wormhole

country_event = {
	id = eo_wormhole.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_system_within_border = {
			has_star_flag = wormhole_home_of_@prev
		}
	}
	immediate = {
		save_event_target_as = wormhole_owner
		random_system_within_border = {
			limit = {
				has_star_flag = wormhole_home_of_@prev
			}
			save_event_target_as = wormhole_home_system
		}
		random_system = {
			limit = {
				has_star_flag = connected_system_of_@event_target:wormhole_home_system
			}
			save_event_target_as = wormhole_connected_system
			create_country = {
				name = "NAME_Incoming_Asteroid"
				type = neutral_faction
			}
			last_created_country = {
				set_country_flag = wormhole_asteroid
				establish_communications_no_message = event_target:wormhole_owner
				create_fleet = {
					name = "NAME_Asteroid"
					effect = {
						set_owner = PREV
						set_fleet_flag = wormhole_asteroid
						create_ship = {
							name = "NAME_Asteroid"
							design = "NAME_Asteroid"
						}
						set_location = {
							target = event_target:wormhole_connected_system
							distance = 120
							angle = 270
						}
						queue_actions = {
							move_to = event_target:wormhole_home_system
						}
					}
				}
			}
		}
	}
}

fleet_event = {
	id = eo_wormhole.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		THIS = {
			has_fleet_flag = wormhole_asteroid
		}
	}
	immediate = {
		THIS = {
			fleet_event = { id = eo_wormhole.3 days = 5 }
		}
	}
}

fleet_event = {
	id = eo_wormhole.3
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		create_ambient_object = {
			type = wormhole_asteroid_object
			location = THIS
			use_3d_location = yes
		}
		destroy_fleet = this
	}
}