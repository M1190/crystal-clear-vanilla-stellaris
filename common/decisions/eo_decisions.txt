decision_gray_goo_harvest_planet = {
	icon = decision_shattered_planet
	sound = event_structural_collapse
	enactment_time = 30
	resources = {
		category = decisions
	}
	owned_planets_only = yes
	potential = {
		owner = {
			is_machine_empire = yes
			has_origin = origin_gray_goo
		}
		habitable_structure = no
		is_capital = no
	}
	allow = {
		count_owned_pop = {
			limit = {
				has_trait = trait_nanomachines
			}
			count >= 2
		}
	}
	effect = {
		#custom_tooltip = decision_gray_goo_harvest_planet_effect_desc
		save_event_target_as = gray_gooed_planet
		hidden_effect = {
			owner = {
				country_event = {
					id = eo_gray_goo.2
					days = 1
				}
			}
		}
		random_owned_pop = {
			limit = {
				has_trait = trait_nanomachines
			}
			kill_pop = yes
		}
		random_owned_pop = {
			limit = {
				has_trait = trait_nanomachines
			}
			kill_pop = yes
		}
		every_owned_pop = {
			limit = {
				is_being_purged = yes
				has_purge_type = {
					type = purge_displacement
					country = root.owner
				}
				is_valid_refugee_pop = yes
			}
			save_event_target_as = refugee_pop			#Must be saved for refugee_pop_effect to work
			refugee_pop_effect = yes
		}
		every_owned_pop = {
			limit = {
				is_being_purged = yes
			}
			kill_pop = yes
			if = {
				limit = {
					is_robotic_species = no
					is_lithoid = no
				}
				from = {
					add_resource = {
						food = 150
					}
				}
			}
			else_if = {
				limit = {
					is_lithoid = yes
				}
				from = {
					add_resource = {
						minerals = 150
					}
				}
			}
			else_if = {
				limit = {
					is_robotic_species = yes
				}
				from = {
					add_resource = {
						alloys = 75
					}
				}
			}
		}
		every_owned_pop = {
			resettle_pop = {
				pop = this
				planet = owner.capital_scope
			}
		}
		change_pc = pc_gray_goo
		hidden_effect = {
			clear_deposits = yes
		}
		add_planet_flag = gray_goo_harvest_world
		add_deposit = d_gray_goo_resources
		custom_tooltip = gray_goo_resource_cache_from_harvest
	}
	ai_weight = {
		weight = 5
		# don't wreck worlds you want to keep
		modifier = {
			factor = 0
			exists = owner
			OR = {
				planet_size > 15
				AND = {
					num_free_districts = {
						type = district_mining
						value > 2
					}
					num_free_districts = {
						type = district_generator
						value > 2
					}
				}
				is_planet_class = pc_city
				is_planet_class = pc_relic
				is_planet_class = pc_machine
			}
			owner = {
				num_owned_planets <= 3
			}
		}
	}
}
