# Vanilla scripted triggers
# Expanded by me for more cross-mod comp and to ease the game rules coding.
is_megacorp = {
	OR = {
		has_authority = auth_corporate
		has_valid_civic = civic_galactic_sovereign_megacorp
		# Warship Girls R And MIST Species
		has_authority = auth_warshipgirls
		# Stellaris Evolved
		has_authority = auth_tec_patrocorporate
		# More Authorities
		has_government = gov_imperial_domain_megacorp
		has_authority = auth_corporate_imperial
		# Ethics and Civics - Bug Branch
		has_authority = auth_bugged_corporate_democratic
		has_authority = auth_bugged_corporate_imperial
		# Expanded Traits, Civics, Pops, and More
		has_authority = auth_private
		has_authority = auth_cooperative		# Also More Corporate Authorities
		# Expanded Gestalts: Forgotten Queens
		has_valid_civic = civic_mutualistic_behavior
		# More Corporate Authorities
		has_authority = auth_corporate_fiefdom
	}
}

is_regular_empire = {
	OR = {
		is_country_type = default
		is_country_type = fallen_empire
		is_country_type = awakened_fallen_empire
		# ZOFE
		is_zofe_country = yes
		# The Empty Vagrant
		is_country_type = default_ev
		is_country_type = fallen_empire_ev
		is_country_type = awakened_fallen_empire_ev
		# Merger of Rules
		# prevents these special countries from destroying their own buildings and districts in their colonies
		is_country_type = gate_builders
		is_country_type = awakened_marauders
	}
	is_gestalt = no
}

is_fallen_empire = {
	OR = {
		is_country_type = fallen_empire
		is_country_type = awakened_fallen_empire
		# SW:KUAT ANCIENT EMPIRE
		is_country_type = kuat_fallen_empire
		is_country_type = kuat_awakened_fallen_empire
		is_country_type = awakened_return_kuat_empire
		# A Deadly Tempest
		is_country_type = awakened_gate_builders
		# History of the Lost Empire
		is_country_type = LsE_fallen_empire
	}
}

is_homicidal = {
	OR = {
		has_valid_civic = civic_fanatic_purifiers
		has_valid_civic = civic_machine_terminator
		has_valid_civic = civic_hive_devouring_swarm
		# Expanded Traits, Civics, Pops, and More
		has_valid_civic = civic_infestation
	}
}

colonizable_planet = {
	OR = {
		is_planet_class = pc_city
		is_planet_class = pc_relic
		is_planet_class = pc_nuked
		is_planet_class = pc_hive
		is_planet_class = pc_machine
		habitable_structure = yes
		habitable_planet = yes
		is_artificial = yes
		# ACOT
		is_planet_class = pc_dark_fractured
		is_planet_class = pc_dark_fractured_ae
		is_planet_class = pc_acot_enigmopolis
		# Planetary Diversity
		is_planet_class = pc_pdshroud
		is_planet_class = pc_irradiated
		# Gigastructures
		is_planet_class = pc_katzenland
		# SW:UnknownWorld Shipgirls Story
		is_planet_class = pc_swgs_engineer
		is_planet_class = pc_swgs_engineer_ringworld_habitable
		# Warship Girls R And MIST Species
		is_planet_class = pc_wsg_port
		is_planet_class = pc_shenhai
		# APSR: Anomalies, Planetary and Space Resources
		has_apsr_modifiers = yes
		# Endless Frontier
		is_planet_class = pc_mzilli_shadow
		### SOFE
		is_planet_class = pc_golden_world
		is_planet_class = pc_golden_world_habitable
		is_planet_class = pc_omega_ringworld_habitable
		is_planet_class = pc_omega_ringworld_seam
		is_planet_class = pc_omega_ringworld_tech
		is_planet_class = pc_goodman_gaia_world
		is_planet_class = pc_golden_fortress
		is_planet_class = pc_sosi_proto_gaia_world
	}
}

habitable_planet = {
	OR = {
		is_planet_class = pc_desert
		is_planet_class = pc_tropical
		is_planet_class = pc_arid
		is_planet_class = pc_continental
		is_planet_class = pc_ocean
		is_planet_class = pc_tundra
		is_planet_class = pc_arctic
		is_planet_class = pc_alpine
		is_planet_class = pc_savannah
		is_planet_class = pc_gaia
		is_planet_class = pc_relic
		is_planet_class = pc_city
		is_planet_class = pc_hive
		# Planetary Diversity
		is_planet_class = pc_megaflorahive
		is_planet_class = pc_megafloratol
		is_planet_class = pc_pdhive1
		is_planet_class = pc_pdhive2
		is_planet_class = pc_bioforge
		is_planet_class = pc_biocapital
		is_planet_class = pc_biofort
		is_pd_regular = yes
		is_pd_gaia = yes
		is_pd_rare = yes
		# Warship Girls R And MIST Species
		is_planet_class = pc_wsg_port
		is_planet_class = pc_shenhai
		# SW: UnknownWorld Shipgirls Story
		is_planet_class = pc_swgs_engineer
		is_planet_class = pc_swgs_engineer_ringworld_habitable
		# Gigastructures
		is_planet_class = pc_ll_temperate
		is_planet_class = pc_ll_foggy
		is_planet_class = pc_ll_torrid
		# Real Space - New Frontiers / Expanded Gestalts: Forgotten Queens
		is_planet_class = pc_hollow
		# Giga Diversity
		is_planet_class = pc_ll_methane
		is_planet_class = pc_ll_ash
		is_planet_class = pc_ll_sulfur
		is_planet_class = pc_ll_ammonia
		is_planet_class = pc_ll_ocean
		is_planet_class = pc_ll_tidallylocked_cold
		is_planet_class = pc_ll_tidallylocked
		is_planet_class = pc_ll_rogue
	}
}

uninhabitable_regular_planet = {
	OR = {
		is_planet_class = pc_molten
		is_planet_class = pc_barren
		is_planet_class = pc_barren_cold
		is_planet_class = pc_toxic
		is_planet_class = pc_frozen
		# Planetary Diversity
		is_planet_class = pc_hothouse
	}
}

# Enforcing proper use of this trigger. You don't need to overwrite it since 3.0!
habitable_structure = {
	is_artificial = yes
	OR = {
		is_colony = yes
		is_colonizable = yes
	}
}

is_a_habitable_planet_megastructure = {
	OR = {
		is_planet_class = pc_infested
		# Expanded Gestalts: Forgotten Queens
		is_planet_class = pc_matryoshka
		# ACOT
		is_planet_class = pc_dark_fractured
		is_planet_class = pc_dark_fractured_ae
		is_planet_class = pc_acot_enigmopolis
		colonizable_planet = yes		# Ariphaos patch
		habitable_structure = yes
	}
}

#FOR CUSTODIAN
is_crisis_faction = {
	OR = {
		is_country_type = swarm
		is_country_type = extradimensional
		is_country_type = extradimensional_2
		is_country_type = extradimensional_3
		is_country_type = ai_empire
		is_country_type = gray_goo
		is_country_type = awakened_marauders
		# ACOT
		is_country_type = original_empire
		# Cruel Conquerers
		is_cruel_abomination_country_type = yes
		# Gigastructural Engineering & More
		is_country_type = katzenartig_imperium
		is_country_type = dormant_aeternum
		# Solar Storm
		is_country_type = abyssal_host_invaders_type
		# Shroud Rising
		is_country_type = shroud_cult
		is_country_type = shroud_entities
		is_country_type = shroud_horrors
	}
}

has_encountered_other_species = {
	OR = {
		has_origin = origin_syncretic_evolution
		has_origin = origin_necrophage
		has_valid_civic = civic_machine_servitor
		# Ethics and Civics Classic and all its variants
		has_valid_civic = civic_symbiotic_race
		has_valid_civic = civic_slave_race
		# Ethics & Civics: Bug Branch
		is_bugged_evolutionary_architects = yes
		is_bugged_slave_race = yes
		# Vanilla
		num_communications > 0
		any_owned_pop = {
			NOR = {
				has_trait = "trait_mechanical"
				is_same_species = prev
			}
		}
	}
}

is_organic_species = {
	species = {
		OR = {
			is_archetype = BIOLOGICAL
			is_archetype = LITHOID
			# Warship Girls R And MIST Species
			is_archetype = WARSHIPGIRL
			is_archetype = SHENHAI
			# SW:UnknownWorld Shipgirls Story
			is_archetype = STARSHIPGIRLS
			# Kancolle
			is_archetype = KANMUSU
			# Azur Lane Stellaris DLC
			is_archetype = KANSEN
			# Empire of Eeveelution
			is_archetype = POKEMON
			# AshArms Aquarius history
			is_archetype = Dolls
			# Expanded Traits, Civics, Pops, and More
			is_archetype = HUMANOID
			is_archetype = MAMMALIAN
			is_archetype = REPTILIAN
			is_archetype = AVIAN
			is_archetype = ARTHROPOID
			is_archetype = MOLUSCOID
			is_archetype = FUNGOID
			is_archetype = PLANTOID
			is_archetype = NECROID
			is_archetype = half_species
			is_archetype = half_species_special
			is_archetype = half_aberration
			is_archetype = half_perfect
			is_archetype = half_amalgamated
			# Aquatic Portraits mod
			is_archetype = JAYPEES_AQUATIC
			is_archetype = JAYPEES_BRAIN
			is_archetype = JAYPEES_CRAB
			is_archetype = JAYPEES_DOLPHIN
			is_archetype = JAYPEES_DUMBO
			is_archetype = JAYPEES_ELESQUID
			is_archetype = JAYPEES_FISH
			is_archetype = JAYPEES_HAIRTENTACLE
			is_archetype = JAYPEES_SEAL
			is_archetype = JAYPEES_SQUID
			is_archetype = JAYPEES_TURTLEHORSE
			# The DAL Species Mod
			is_archetype = DATEALIVE
			# Nyto Species Events Pack
			is_archetype = NYTO
			# Silfae's Portrait Revisited
			AND = {
				is_archetype = HOLOARCH
				NOR = {
					has_trait = trait_holofrixigram
					has_trait = trait_holofrixigram_2
					has_trait = trait_holofrixigram_3
				}
			}
			# Cryogenesis Unofficial Species Pack
			is_archetype = sm_ELEMENTAL
		}
	}
}

is_country_type_with_subjects = {
	OR = {
		is_country_type = default
		is_country_type = awakened_fallen_empire
		is_country_type = awakened_marauders
		# ZOFE
		is_zofe_country = yes
		# The Empty Vagrant
		is_country_type = default_ev
		# ACOT
		is_progenitor_empires = yes
		# Twinks Eternal Empire
		is_country_type = eternal_empire
	}
}

has_comms_with_alien_empire = {
	any_relation = {
		has_communications = root
		OR = {
			merg_is_default_empire = yes
			is_country_type = fallen_empire
			is_country_type = awakened_fallen_empire
			# ACOT
			is_progenitor_empires = yes
			is_country_type = sofe_light_seeker
			# Twinks Eternal Empire
			is_country_type = eternal_empire
		}
	}
}

has_comms_with_alien_civilization = {
	any_relation = {
		has_communications = root
		OR = {
			merg_is_default_empire = yes
			is_country_type = fallen_empire
			is_country_type = awakened_fallen_empire
			is_country_type = enclave
			is_country_type = nomad
			is_country_type = dormant_marauders
			is_country_type = awakened_marauders
			# ACOT
			is_progenitor_empires = yes
			is_country_type = sofe_light_seeker
			# Twinks Eternal Empire
			is_country_type = eternal_empire
		}
	}
}

is_autocracy = {
	#Power of one
	OR = {
		is_gestalt = yes
		has_authority = auth_imperial
		has_authority = auth_dictatorial
		# More Authorities
		has_authority = auth_corporate_imperial
		AND = {
			has_authority = auth_democratic_dictatorship
			is_authoritarian = yes
		}
		# Expanded Traits, Civics, Pops, and More
		has_authority = auth_private
		# More Corporate Authorities
		has_authority = auth_corporate_fiefdom
		# Ethics and Civics Bug Branch
		has_authority = auth_bugged_corporate_imperial
	}
}

is_democracy = {
	#Power of many
	OR = {
		has_authority = auth_democratic
		AND = {
			has_authority = auth_corporate
			is_egalitarian = yes
		}
		# More Authorities
		has_authority = auth_strict_democratic
		has_authority = auth_direct_democratic		# Also used by Stellaris Evolved
		AND = {
			has_authority = auth_democratic_dictatorship
			is_egalitarian = yes
		}
		# Expanded Traits, Civics, Pops, and More
		has_authority = auth_cooperative
		# Ethics and Civics Bug Branch
		has_authority = auth_bugged_direct_democratic
		has_authority = auth_bugged_corporate_democratic
	}
}

is_valid_refugee_pop = {
	is_robot_pop = no
	NOR = {
		has_trait = trait_hive_mind
		has_trait = trait_nerve_stapled
		has_trait = trait_zombie
		# Expanded Gestalts
		has_trait = trait_machine_digital
	}
	owner = {
		any_relation = {
			merg_is_default_empire = yes
			has_communications = prev			#relations include countries that have made first contact but not established comms
			OR = {
				NOT = {
					has_policy_flag = refugees_not_allowed
				}
				# Expanded Gestalts
				has_valid_civic = civic_mutualistic_behavior
			}
			prevprev = {
				#this ensures Pop scope, as root will not always be pop scope
				OR = {
					has_citizenship_type = {
						type = citizenship_full
						country = prev
					}
					has_citizenship_type = {
						type = citizenship_caste_system
						country = prev
					}
					AND = {
						has_citizenship_type = {
							type = citizenship_limited
							country = prev
						}
						has_citizenship_type = {
							type = citizenship_caste_system_limited
							country = prev
						}
						prev = {
							has_policy_flag = refugees_allowed
						}
					}
					# Expanded Gestalts
					prev = {
						has_valid_civic = civic_mutualistic_behavior
					}
				}
			}
			any_owned_planet = {
				is_under_colonization = no
				is_controlled_by = owner
				has_orbital_bombardment = no
			}
		}
	}
}

has_any_habitability = {
	merg_is_default_empire = yes
	has_communications = prev
	OR = {
		NOT = {
			has_policy_flag = refugees_not_allowed
		}
		# Expanded Gestalts
		has_valid_civic = civic_mutualistic_behavior
	}
	event_target:refugee_pop = {
		OR = {
			has_citizenship_type = {
				type = citizenship_full
				country = prev
			}
			has_citizenship_type = {
				type = citizenship_caste_system
				country = prev
			}
			AND = {
				has_citizenship_type = {
					type = citizenship_limited
					country = prev
				}
				has_citizenship_type = {
					type = citizenship_caste_system_limited
					country = prev
				}
				prev = {
					has_policy_flag = refugees_allowed
				}
			}
			# Expanded Gestalts
			prev = {
				has_valid_civic = civic_mutualistic_behavior
			}
		}
	}
	any_owned_planet = {
		is_under_colonization = no
		is_controlled_by = owner
		has_orbital_bombardment = no
	}
}

has_phototrophic_energy_upkeep = {
	OR = {
		has_trait = trait_plantoid_phototrophic
		AND = {
			OR = {
				has_trait = trait_plantoid_radiotrophic
				has_trait = trait_harvested_radiotrophic
			}
			NOR = {
				planet = {
					is_planet_class = pc_nuked
				}
				# Planetary Diversity
				planet = {
					is_planet_class = pc_irradiated
				}
				# Galaxius
				planet = {
					is_planet_class = pc_ie_gateway
				}
				# Giga Diversity
				planet = {
					is_planet_class = pc_katzenland
				}
				# Real Space
				planet = {
					is_planet_class = pc_depleted
				}
			}
		}
	}
}

# Overwriting with vanilla for a correct use of the triggers
is_wet = {
	has_climate = wet
}

is_dry = {
	has_climate = dry
	NOT = {
		is_planet_class = pc_city
	}
}

is_cold = {
	has_climate = cold
}

# Merging and fixing
default_endgame_early_start_triggers = {
	AND = {
		OR = {
			NOT = {
				any_country = {
					OR = {
						merg_is_fallen_empire = yes
						merg_is_awakened_fe = yes
					}
				}
			}
			has_global_flag = no_war_in_heaven
			AND = {
				has_global_flag = war_in_heaven_started
				OR = {
					has_global_flag = war_in_heaven_ended
					NOT = {
						has_global_flag = war_in_heaven_recently_started
					}
				}
			}
		}
		# ACOT
		OR = {
			has_global_flag = acot_dangerous_forbidden
			NOR = {
				has_global_flag = acot_war_in_hell_active
				has_global_flag = active_sofe_crisis
			}
		}
		NOR = {
			# Nirvana Empire Project
			has_global_flag = difficult_exe_invasion
			# Star Wars: UnknownWorld Shipgirls Story
			has_global_flag = afk_crisis_real
			# Warship Girls R And MIST Species
			has_global_flag = wg_crisis_insane
		}
	}
}

has_total_war_cb = {
	OR = {
		#attacker checks
		AND = {
			OR = {
				merg_is_default_empire = yes
				is_fallen_empire = yes
				# ACOT
				is_progenitor_empires = yes
				# Twinks Eternal Empire
				is_country_type = eternal_empire
			}
			OR = {
				merg_is_awakened_fe = yes
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_machine_assimilator
				# Expanded Traits, Civics, Pops, and More
				has_valid_civic = civic_infestation
				# ACOT
				is_progenitor_empires = yes
				# Twinks Eternal Empire
				is_country_type = eternal_empire
				# Vanilla
				AND = {
					has_valid_civic = civic_machine_terminator
					from = {
						is_synthetic_empire = no
					}
				}
				AND = {
					has_valid_civic = civic_fanatic_purifiers
					NOT = {
						is_same_species = from
					}
				}
			}
		}
		#end threat checks
		AND = {
			OR = {
				merg_is_default_empire = yes
				# ACOT
				is_progenitor_empires = yes
				# Twinks Eternal Empire
				is_country_type = eternal_empire
			}
			NOR = {
				is_country_type = awakened_fallen_empire
				is_homicidal = yes
				has_valid_civic = civic_machine_assimilator
				# Expanded Traits, Civics, Pops, and More
				has_valid_civic = civic_infestation
			}
			from = {
				OR = {
					merg_is_awakened_fe = yes
					is_homicidal = yes
					has_valid_civic = civic_machine_assimilator
					# Expanded Traits, Civics, Pops, and More
					has_valid_civic = civic_infestation
					# ACOT
					is_progenitor_empires = yes
				}
			}
		}
	}
}

can_think = {
	NOR = {
		has_trait = trait_nerve_stapled
		has_trait = trait_zombie
		# Expanded Events
		has_trait = trait_memorex_comatos
		# Diagraphers Trait Mod
		has_trait = trait_subsapient_form
	}
}

has_special_star_flag_trigger = {
	OR = {
		# Start System Flags
		has_star_flag = empire_home_system
		has_star_flag = neighbor_t1
		has_star_flag = neighbor_t1_first_colony
		has_star_flag = neighbor_t2
		has_star_flag = neighbor_t2_second_colony
		# Enclaves
		has_star_flag = enclave
		has_star_flag = caravaneer_home
		# L-Gate
		has_star_flag = lgate
		has_star_flag = lcluster1
		has_star_flag = lcluster2
		has_star_flag = lcluster3
		has_star_flag = lcluster4
		has_star_flag = lcluster5
		has_star_flag = lcluster_lgate
		has_star_flag = lgateguaranteed
		# Leviathans
		has_star_flag = tiyanki_home_system
		has_star_flag = amoeba_home_system
		has_star_flag = crystal_system
		has_star_flag = crystal_home_system
		has_star_flag = drone_home_system
		has_star_flag = crystal_splitter_starting_system
		has_star_flag = crystal_splitter_destination_system
		# Hostile Systems
		has_star_flag = marauder_system
		has_star_flag = hostile_system
		has_star_flag = guardian
		has_star_flag = sealed_system
		# Megastructures
		has_star_flag = abandoned_gateway
		has_star_flag = ruined_mega_shipyard_system
		has_star_flag = ruined_dyson_system
		has_star_flag = ruined_catapult_system
		has_star_flag = ruined_nexus_system
		has_star_flag = ruined_orbital_ring_system
		has_star_flag = ruined_sentry_system
		has_star_flag = ruined_ring_system
		# Others
		has_star_flag = mechanocalibrator_system
		has_star_flag = rubricator_system
		has_star_flag = last_baol_system
		has_star_flag = Zrocursor
		has_star_flag = overlord_empire_flag
		# Ancient Empire
		has_star_flag = ag_no_jump_in_system
		# ACOT
		has_star_flag = outercluster
		# Warship Girls R And MIST Species
		has_star_flag = wg_sealed_system
		has_star_flag = wg_psionic_systems
		# SW:Kuat Ancient Empire
		has_star_flag = Kuat_system
		has_star_flag = Kuat_system_1
		has_star_flag = Kuat_system_2
		has_star_flag = Kuat_system_3
		has_star_flag = kuat_initial_system
		has_star_flag = Kuat_system_int
		has_star_flag = Kuat_system_int_1
		has_star_flag = Kuat_system_int_2
		has_star_flag = Kuat_system_int_3
		has_star_flag = Kuat_system_int_4
		has_star_flag = starkiller_system
		# Gigastructural Engineering and More
		has_star_flag = giga_core_03
		# Some Events of Outside Cluster
		has_star_flag = nep_Krahen_cluster
		has_star_flag = nep_Scrus_cluster
		has_global_flag = nep_not_pass_Aemethms
		has_star_flag = nep_dragon_system
		has_star_flag = nep_heptagram_cluster
		# Real Space
		has_star_flag = star_disaster
	}
}

planet_can_be_liberated_from_owner = {
	owner = {
		NOR = {
			has_authority = auth_hive_mind
			has_authority = auth_machine_intelligence
			is_country_type = awakened_fallen_empire
			is_country_type = fallen_empire
			is_country_type = ascended_empire
			# ZOFE
			is_country_type = lost_empire
			# ACOT
			is_country_type = original_empire_active
			# Twinks Eternal Empire
			is_country_type = eternal_empire
		}
	}
}

can_fill_specialist_job = {
	custom_tooltip = SPECIALIST_JOB_TRIGGER
	hidden_trigger = {
		is_gestalt = no
		exists = owner
		OR = {
			is_enslaved = no
			has_slavery_type = {
				type = slavery_indentured
			}
		}
		is_being_purged = no
		is_being_assimilated = no
		NOR = {
			has_trait = trait_syncretic_proles
			# Expanded Traits, Civics, Pops, and More
			has_trait = trait_tree_caretaker
			# Ethics and Civics Alternative - Redux
			has_trait = trait_slave_gene
		}
		can_think = yes
		OR = {
			NOT = {
				has_trait = trait_mechanical
			}
			owner = {
				has_technology = tech_droid_workers
			}
		}
		NOT = {
			has_citizenship_type = {
				type = citizenship_organic_trophy
			}
		}
		if = {
			limit = {
				divinity_right_to_work_job_check_trigger_exempt = no
			}
			divinity_right_to_work_job_check_trigger_specialist = yes
		}
	}
}
