#############
# Government buildings
#############
building_noble_estates = {
	base_buildtime = @b2_time
	icon = building_palace
	base_cap_amount = 1
	category = government
	potential = {
		owner = {
			OR = {
				has_valid_civic = civic_aristocratic_elite
				has_valid_civic = civic_royal_trading_company
			}
		}
		NOT = {
			has_modifier = slave_colony
		}
	}
	allow = {
		has_upgraded_capital = yes
		buildings_simple_allow = yes
	}
	destroy_trigger = {
		exists = owner
		owner = {
			NOR = {
				has_valid_civic = civic_aristocratic_elite
				has_valid_civic = civic_royal_trading_company
			}
		}
	}
	planet_modifier = {
		job_noble_add = 1
		planet_housing_add = 3
		planet_amenities_add = 5
	}
	resources = {
		category = planet_buildings
		cost = {
			minerals = @b1_minerals
		}
		upkeep = {
			energy = 2
		}
	}
	triggered_desc = {
		text = job_noble_effect_desc
	}
	ai_resource_production = {
		trigger = {
			num_pops > 40
		}
		unity > 8
	}
	upgrades = {
		"building_palatial_estates"
	}
}

building_palatial_estates = {
	base_buildtime = @b2_time
	category = government
	potential = {
		has_building = building_noble_estates
		owner = {
			OR = {
				has_valid_civic = civic_aristocratic_elite
				has_valid_civic = civic_royal_trading_company
			}
		}
		NOT = {
			has_modifier = slave_colony
		}
	}
	allow = {
		has_major_upgraded_capital = yes
		buildings_simple_allow = yes
	}
	destroy_trigger = {
		exists = owner
		owner = {
			NOR = {
				has_valid_civic = civic_aristocratic_elite
				has_valid_civic = civic_royal_trading_company
			}
		}
	}
	planet_modifier = {
		job_noble_add = 2
		planet_housing_add = 6
		planet_amenities_add = 10
	}
	resources = {
		category = planet_buildings
		cost = {
			minerals = @b1_minerals
		}
		upkeep = {
			energy = 2
		}
	}
	triggered_desc = {
		text = job_noble_effect_desc
	}
	resources = {
		category = planet_buildings
		cost = {
			minerals = @b2_minerals
			rare_crystals = @b2_rare_cost
		}
		upkeep = {
			energy = 3
			rare_crystals = @b2_rare_upkeep
		}
	}
	prerequisites = {
		"tech_paradise_dome"
	}
	show_tech_unlock_if = {
		OR = {
			has_valid_civic = civic_aristocratic_elite
			has_valid_civic = civic_royal_trading_company
		}
	}
	on_queued = {
		IF = {
			limit = {
				owner = {
					has_technology = tech_construction_templates
				}
			}
			owner = {
				set_timed_country_flag = {
					flag = buildings_new_crystal_building
					days = 270
				}
			}
		}
		ELSE_IF = {
			limit = {
				owner = {
					has_technology = tech_assembly_pattern
				}
			}
			owner = {
				set_timed_country_flag = {
					flag = buildings_new_crystal_building
					days = 390
				}
			}
		}
		else = {
			planet = {
				owner = {
					set_timed_country_flag = {
						flag = buildings_new_crystal_building
						days = 510
					}
				}
			}
		}
	}
	ai_resource_production = {
		trigger = {
			num_pops > 40
		}
		unity > 8
	}
}

building_slave_processing = {
	base_buildtime = @b1_time
	base_cap_amount = 1
	category = government
	potential = {
		owner = {
			is_regular_empire = yes
		}
		owner = {
			has_policy_flag = slavery_allowed
		}
		NOT = {
			has_modifier = resort_colony
		}
	}
	allow = {
		has_upgraded_capital = yes
	}
	destroy_trigger = {
		# destroys if true
		exists = owner
		OR = {
			owner = {
				is_regular_empire = no
			}
			NOT = {
				owner = {
					has_policy_flag = slavery_allowed
				}
			}
			has_modifier = resort_colony
		}
	}
	planet_modifier = {
		planet_jobs_slave_produces_mult = 0.05
		pop_cat_slave_political_power = -0.25
	}
	resources = {
		category = planet_buildings
		cost = {
			minerals = @b1_minerals
		}
		upkeep = {
			energy = 2
		}
	}
	prerequisites = {
		"tech_neural_implants"
	}
	triggered_desc = {
		text = building_slave_processing_slave_army_effect_desc
	}
	triggered_desc = {
		text = allows_slave_migration
	}
}

building_precinct_house = {
	base_buildtime = @b1_time
	position_priority = 125
	category = government
	potential = {
		owner = {
			is_regular_empire = yes
		}
		NOT = {
			has_modifier = slave_colony
		}
	}
	allow = {
		hidden_trigger = {
			OR = {
				owner = {
					is_ai = no
				}
				AND = {
					planet_crime > 15
					NOR = {
						AND = {
							has_building = building_precinct_house
							owner = {
								has_technology = tech_colonial_centralization
							}
						}
						has_building = building_hall_judgment
						num_buildings = {
							type = building_precinct_house
							value = 3
						}
					}
				}
			}
		}
	}
	destroy_trigger = {
		exists = owner
		OR = {
			NOT = {
				owner = {
					is_regular_empire = yes
				}
			}
			AND = {
				owner = {
					is_ai = yes
				}				#Players dont like random buildings blowing up
				planet = {
					has_building = building_hall_judgment
				}
			}
			#This way the AI gets to reclaim its building slots that it sunk into this expense
		}
	}
	planet_modifier = {
		job_enforcer_add = 2
	}
	resources = {
		category = planet_buildings
		cost = {
			trigger = {
				exists = owner
				owner = {
					is_civic_plant_organic = no
				}
			}
			minerals = @b1_minerals
		}
		cost = {
			trigger = {
				exists = owner
				owner = {
					is_civic_plant_organic = yes
				}
			}
			minerals = @b1_hive_minerals
			food = @b1_hive_food
		}
		upkeep = {
			trigger = {
				exists = owner
				owner = {
					is_civic_plant_organic = yes
				}
			}
			energy = @b1_upkeep_hive
			food = @b1_upkeep_food
		}
		upkeep = {
			trigger = {
				exists = owner
				owner = {
					is_civic_plant_organic = no
				}
			}
			energy = @b1_upkeep
		}
	}
	prerequisites = {
		"tech_planetary_government"
	}
	triggered_desc = {
		text = job_enforcer_effect_desc
	}
	show_tech_unlock_if = {
		is_regular_empire = yes
	}
	upgrades = {
		building_hall_judgment
	}
}

building_hall_judgment = {
	base_buildtime = @b2_time
	position_priority = 125
	category = government
	can_build = no
	potential = {
		owner = {
			is_regular_empire = yes
		}
		NOT = {
			has_modifier = slave_colony
		}
	}
	destroy_trigger = {
		exists = owner
		OR = {
			buildings_no_motes = yes
			NOT = {
				owner = {
					is_regular_empire = yes
				}
			}
		}
	}
	planet_modifier = {
		job_enforcer_add = 5
	}
	resources = {
		category = planet_buildings
		cost = {
			trigger = {
				exists = owner
				owner = {
					is_civic_plant_organic = no
				}
			}
			minerals = @b2_minerals
			volatile_motes = @b2_rare_cost
		}
		cost = {
			trigger = {
				exists = owner
				owner = {
					is_civic_plant_organic = yes
				}
			}
			minerals = @b2_hive_minerals
			food = @b2_hive_food
			volatile_motes = @b2_rare_cost
		}
		upkeep = {
			trigger = {
				exists = owner
				owner = {
					is_civic_plant_organic = yes
				}
			}
			energy = @b2_upkeep_hive
			food = @b2_upkeep_food
			volatile_motes = @b2_rare_upkeep
		}
		upkeep = {
			trigger = {
				exists = owner
				owner = {
					is_civic_plant_organic = no
				}
			}
			energy = @b2_upkeep
			volatile_motes = @b2_rare_upkeep
		}
	}
	prerequisites = {
		"tech_colonial_centralization"
	}
	triggered_desc = {
		text = job_enforcer_effect_desc
	}
	show_tech_unlock_if = {
		is_regular_empire = yes
	}
}

building_sentinel_posts = {
	base_buildtime = @b1_time
	position_priority = 125
	category = government
	potential = {
		exists = owner
		owner = {
			is_gestalt = yes
		}
	}
	allow = {
		hidden_trigger = {
			OR = {
				owner = {
					is_ai = no
				}
				AND = {
					buildings_simple_allow = yes
					NOT = {
						has_building = building_sentinel_posts
					}
				}
			}
		}
	}
	destroy_trigger = {
		exists = owner
		NOT = {
			owner = {
				is_gestalt = yes
			}
		}
	}
	planet_modifier = {
		job_patrol_drone_add = 2
	}
	resources = {
		category = planet_buildings
		cost = {
			trigger = {
				exists = owner
				owner = {
					is_lithoid_empire = yes
				}
			}
			minerals = @b1_minerals
		}
		cost = {
			trigger = {
				exists = owner
				owner = {
					NOT = {
						has_valid_civic = civic_integrated_bioarchitecture
					}
					is_lithoid_empire = no
				}
			}
			minerals = @b1_hive_minerals
			food = @b1_hive_food
		}
		cost = {
			trigger = {
				exists = owner
				owner = {
					has_valid_civic = civic_integrated_bioarchitecture
					is_lithoid_empire = no
				}
			}
			food = @b1_minerals
		}
		upkeep = {
			trigger = {
				exists = owner
				owner = {
					is_lithoid_empire = no
				}
			}
			energy = @b1_upkeep_hive
			food = @b1_upkeep_food
		}
		upkeep = {
			trigger = {
				exists = owner
				owner = {
					is_lithoid_empire = yes
					NOT = {
						has_valid_civic = civic_integrated_bioarchitecture
					}
				}
			}
			energy = @b1_upkeep_hive
			minerals = @b1_upkeep_food
		}
	}
	prerequisites = {
		"tech_planetary_government"
	}
	triggered_desc = {
		text = job_patrol_drone_effect_desc
	}
	show_tech_unlock_if = {
		is_gestalt = yes
	}
}

#############
# Ascension perks
#############
#Psionic path
building_psi_corps = {
	base_buildtime = @b2_time
	category = government
	base_cap_amount = 1
	potential = {
		custom_tooltip = {
			text = EMPIRE_UNIQUE_BUILDING
			owner = {
				NOT = {
					has_country_flag = building_psi_corps
				}
				NOT = {
					has_country_flag = built_one_psi_corps
				}
			}
		}
		owner = {
			OR = {
				has_ascension_perk = ap_mind_over_matter
				has_origin = origin_shroudwalker_apprentice
			}
		}
		NOT = {
			has_modifier = resort_colony
		}
		NOT = {
			has_modifier = slave_colony
		}
	}
	allow = {
		has_major_upgraded_capital = yes
		buildings_simple_allow = yes
		num_pops >= 50
	}
	destroy_trigger = {
		exists = owner
		NOT = {
			owner = {
				OR = {
					has_ascension_perk = ap_mind_over_matter
					has_origin = origin_shroudwalker_apprentice
				}
			}
		}
	}
	planet_modifier = {
		job_telepath_add = @b1_jobs
		# stability added to jobs
	}
	country_modifier = {
		pop_government_ethic_attraction = 0.05
	}
	resources = {
		category = planet_buildings
		cost = {
			minerals = 500
			sr_zro = @b2_rare_cost
		}
		upkeep = {
			energy = @b2_upkeep
			sr_zro = @b2_rare_upkeep
		}
	}
	triggered_desc = {
		text = job_telepath_effect_desc
	}
	triggered_desc = {
		text = building_psi_corps_effect_desc
	}
	on_queued = {
		owner = {
			set_country_flag = building_psi_corps
		}
	}
	on_unqueued = {
		owner = {
			remove_country_flag = building_psi_corps
		}
	}
	on_built = {
		owner = {
			set_country_flag = built_one_psi_corps
		}
		owner = {
			remove_country_flag = building_psi_corps
		}
		set_planet_flag = built_one_psi_corps
	}
	on_destroy = {
		owner = {
			remove_country_flag = built_one_psi_corps
		}
	}
	ai_resource_production = {
		trigger = {
			num_pops >= 50
		}
		alloys = 4
		energy = 8
		minerals = 8
	}
	ai_resource_production = {
		trigger = {
			is_capital = yes
		}
		alloys = 4
		energy = 8
		minerals = 8
	}
}

### Modded ###
building_individualist_enclave = {
	base_buildtime = @b1_time
	position_priority = 175
	category = government
	icon = building_residence
	category = amenity
	potential = {
		exists = owner
		owner = {
			is_gestalt = yes
			NOR = {
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_closed_collective
				has_valid_civic = civic_machine_servitor
				has_valid_civic = civic_machine_assimilator
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_closed_network
				has_valid_civic = civic_infestation
				has_origin = origin_necrophage
				has_valid_civic = civic_living_hosts
			}
		}
		NOT = {
			is_planet_class = pc_machine
		}
		NOT = {
			is_planet_class = pc_hive
		}
		OR = {
			owner = {
				is_ai = no
			}
			NOR = {
				has_building = building_individualist_enclave
				has_building = building_individualist_colony
			}
			any_owned_pop = {
				is_free_pop_gestalt = yes
				is_unemployed = yes
			}
			owner = {
				has_monthly_income = {
					resource = consumer_goods
					value < 10
				}
			}
		}
	}
	allow = {
		hidden_trigger = {
			buildings_simple_allow = yes
		}
		any_owned_pop = {
			is_free_pop_gestalt = yes
		}
	}
	destroy_trigger = {
		exists = owner
		OR = {
			is_planet_class = pc_machine
			is_planet_class = pc_hive
			NOT = {
				any_owned_pop = {
					is_free_pop_gestalt = yes
				}
			}
			owner = {
				OR = {
					is_gestalt = no
					has_valid_civic = civic_hive_devouring_swarm
					has_valid_civic = civic_closed_collective
					has_valid_civic = civic_machine_servitor
					has_valid_civic = civic_machine_assimilator
					has_valid_civic = civic_machine_terminator
					has_valid_civic = civic_closed_network
					has_valid_civic = civic_infestation
					has_origin = origin_necrophage
					has_valid_civic = civic_living_hosts
				}
			}
		}
	}
	convert_to = {
		building_luxury_residence
		building_communal_housing
	}
	planet_modifier = {
		planet_housing_add = 5
		job_supplier_add = 2
		job_laborer_gestalt_add = 1
	}
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				OR = {
					has_valid_civic = civic_harm_hive
					has_valid_civic = civic_harm_machine
				}
			}
		}
		modifier = {
			job_researcher_gestalt_add = 1
			job_entertainer_gestalt_add = 1
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_technology = tech_housing_1
			}
		}
		modifier = {
			planet_housing_add = 1
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_technology = tech_housing_2
			}
		}
		modifier = {
			planet_housing_add = 1
		}
	}
	resources = {
		category = planet_buildings
		cost = {
			minerals = @b1_minerals
		}
		upkeep = {
			energy = @b1_upkeep
		}
	}
	triggered_desc = {
		text = individualist_enclave_effect_desc
	}
	upgrades = {
		"building_individualist_colony"
	}
	triggered_desc = {
		text = job_administrator_gestalt_effect_desc
	}
	triggered_desc = {
		text = job_enforcer_gestalt_effect_desc
	}
	triggered_desc = {
		text = job_supplier_effect_desc
	}
	#triggered_desc = {
	#	text = job_farmer_gestalt_effect_desc
	#}
	triggered_desc = {
		trigger = {
			exists = owner
			owner = {
				OR = {
					has_valid_civic = civic_harm_hive
					has_valid_civic = civic_harm_machine
				}
			}
		}
		text = job_researcher_gestalt_effect_desc
	}
	triggered_desc = {
		trigger = {
			exists = owner
			owner = {
				OR = {
					has_valid_civic = civic_harm_hive
					has_valid_civic = civic_harm_machine
				}
			}
		}
		text = job_entertainer_gestalt_effect_desc
	}
	ai_resource_production = {
		trigger = {
			always = yes
		}
		consumer_goods = 4
	}
	ai_resource_production = {
		physics_research = 2
		society_research = 2
		engineering_research = 2
		trigger = {
			owner = {
				OR = {
					has_valid_civic = civic_harm_hive
					has_valid_civic = civic_harm_machine
				}
			}
		}
	}
}

building_individualist_colony = {
	base_buildtime = @b2_time
	position_priority = 175
	category = government
	icon = building_paradise_dome
	category = amenity
	potential = {
		has_building = building_individualist_enclave
	}
	allow = {
		has_upgraded_capital = yes
		any_owned_pop = {
			is_free_pop_gestalt = yes
		}
	}
	destroy_trigger = {
		exists = owner
		OR = {
			is_planet_class = pc_machine
			is_planet_class = pc_hive
			NOT = {
				any_owned_pop = {
					is_free_pop_gestalt = yes
				}
			}
			owner = {
				OR = {
					is_gestalt = no
					has_valid_civic = civic_hive_devouring_swarm
					has_valid_civic = civic_closed_collective
					has_valid_civic = civic_machine_servitor
					has_valid_civic = civic_machine_assimilator
					has_valid_civic = civic_machine_terminator
					has_valid_civic = civic_closed_network
					has_valid_civic = civic_infestation
					has_origin = origin_necrophage
					has_valid_civic = civic_living_hosts
				}
			}
		}
	}
	convert_to = {
		building_paradise_dome
		building_communal_housing_large
	}
	planet_modifier = {
		planet_housing_add = 10
		job_supplier_add = 2
		job_laborer_gestalt_add = 4
		job_enforcer_gestalt_add = 1
	}
	#triggered_planet_modifier = {
	#	potential = {
	#		exists = planet
	#		planet = {
	#			NOT = { is_planet_class = pc_habitat }
	#			NOT = { is_planet_class = pc_city }
	#			NOT = { is_planet_class = pc_relic }
	#			any_owned_pop = {
	#				is_free_pop_gestalt = yes
	#				is_lithoid = no
	#			}
	#		}
	#	}
	#	modifier = {
	#		job_farmer_gestalt_add = 4
	#	}
	#}
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				OR = {
					has_valid_civic = civic_harm_hive
					has_valid_civic = civic_harm_machine
				}
			}
		}
		modifier = {
			job_researcher_gestalt_add = 2
			job_entertainer_gestalt_add = 2
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_technology = tech_housing_1
			}
		}
		modifier = {
			planet_housing_add = 1
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_technology = tech_housing_2
			}
		}
		modifier = {
			planet_housing_add = 1
		}
	}
	resources = {
		category = planet_buildings
		cost = {
			minerals = @b2_minerals
			rare_crystals = @b2_rare_cost
		}
		upkeep = {
			energy = 8
		}
	}
	prerequisites = {
		"tech_housing_2"
	}
	show_tech_unlock_if = {
		is_gestalt = yes
		NOR = {
			has_valid_civic = civic_hive_devouring_swarm
			has_valid_civic = civic_closed_collective
			has_valid_civic = civic_machine_servitor
			has_valid_civic = civic_machine_assimilator
			has_valid_civic = civic_machine_terminator
			has_valid_civic = civic_closed_network
			has_valid_civic = civic_infestation
			has_origin = origin_necrophage
			has_valid_civic = civic_living_hosts
		}
	}
	triggered_desc = {
		text = individualist_enclave_effect_desc
	}
	triggered_desc = {
		text = job_administrator_gestalt_effect_desc
	}
	triggered_desc = {
		text = job_enforcer_gestalt_effect_desc
	}
	triggered_desc = {
		text = job_supplier_effect_desc
	}
	#triggered_desc = {
	#	text = job_farmer_gestalt_effect_desc
	#}
	triggered_desc = {
		trigger = {
			exists = owner
			owner = {
				OR = {
					has_valid_civic = civic_harm_hive
					has_valid_civic = civic_harm_machine
				}
			}
		}
		text = job_researcher_gestalt_effect_desc
	}
	triggered_desc = {
		trigger = {
			exists = owner
			owner = {
				OR = {
					has_valid_civic = civic_harm_hive
					has_valid_civic = civic_harm_machine
				}
			}
		}
		text = job_entertainer_gestalt_effect_desc
	}
	ai_resource_production = {
		trigger = {
			always = yes
		}
		consumer_goods = 8
	}
	ai_resource_production = {
		physics_research = 4
		society_research = 4
		engineering_research = 4
		trigger = {
			owner = {
				OR = {
					has_valid_civic = civic_harm_hive
					has_valid_civic = civic_harm_machine
				}
			}
		}
	}
}
